# é‡åŒ–äº¤æ˜“ç³»ç»ŸUIè®¾è®¡æ–¹æ¡ˆ

å‚è€ƒVNPYï¼Œæ‰“é€ ç°ä»£åŒ–çš„é‡åŒ–äº¤æ˜“ç•Œé¢

**åŸºäºé¡¹ç›®å®é™…æƒ…å†µï¼šF:\PyProjects\futu_backtest_trader**

---

## ğŸ¯ **ç³»ç»Ÿæ¦‚è¿°**

åŸºäºä½ ç°æœ‰çš„ä»£ç åº“ï¼Œè®¾è®¡ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„é‡åŒ–äº¤æ˜“ç³»ç»Ÿï¼ŒåŒ…å«ï¼š

1. **å›æµ‹ç³»ç»Ÿ** - å¤šç­–ç•¥å›æµ‹ã€å‚æ•°ä¼˜åŒ–
2. **è‡ªåŠ¨åŒ–äº¤æ˜“** - è¿æ¥Futuå®ç›˜/æ¨¡æ‹Ÿç›˜ã€å®šæ—¶ä»»åŠ¡
3. **ä¿¡å·æ˜¾ç¤º** - å®æ—¶ä¹°å–ä¿¡å·æé†’ã€æ¯æ—¥è‡ªåŠ¨åˆ†æ
4. **æ–°é—»åˆ†æ** - è‚¡ç¥¨æ–°é—»å’ŒåŸºæœ¬é¢åˆ†æ
5. **å¯è§†åŒ–** - Kçº¿å›¾ã€æŒ‡æ ‡ã€æŒä»“

---

## ğŸ”‘ **æ ¸å¿ƒè®¾è®¡è¦ç‚¹**

### **1. å¤šæ•°æ®æºæ¶æ„ï¼ˆä¸‰å¸‚åœºæ”¯æŒï¼‰**

```python
ç¾è‚¡æ•°æ®:
âœ… æ¥æº: FinancialDatasets API
âœ… æ”¯æŒ: TSLA, NVDA, AAPLç­‰
âœ… ç‰¹ç‚¹: æ— éœ€Futuè¿æ¥
âœ… ç¼“å­˜: data_cache.py
âœ… è¯†åˆ«: ä¸å«å‰ç¼€ï¼ˆTSLA, AAPLï¼‰

æ¸¯è‚¡æ•°æ®:
âœ… æ¥æº: Futu OpenAPI
âœ… æ”¯æŒ: HK.01797, HK.00700ç­‰
âœ… ç‰¹ç‚¹: éœ€è¦Futu OpenDè¿è¡Œ
âœ… å®æ—¶: æ”¯æŒå®æ—¶è¡Œæƒ…
âœ… è¯†åˆ«: HK.å‰ç¼€ï¼ˆHK.01797ï¼‰

Aè‚¡æ•°æ®ï¼ˆæ–°å¢ï¼‰:
âœ… æ¥æº1: Tushare APIï¼ˆæ¨èï¼‰
  â”œâ”€ ä¼˜åŠ¿: æ•°æ®å…¨é¢ã€è´¨é‡é«˜
  â”œâ”€ æ”¯æŒ: è‚¡ç¥¨ã€æŒ‡æ•°ã€è´¢åŠ¡æ•°æ®
  â”œâ”€ æˆæœ¬: å…è´¹é¢åº¦ + ä»˜è´¹ç§¯åˆ†
  â””â”€ è®¤è¯: éœ€è¦æ³¨å†Œè·å–token

âœ… æ¥æº2: ä¸œæ–¹è´¢å¯ŒAPIï¼ˆå¤‡é€‰ï¼‰
  â”œâ”€ ä¼˜åŠ¿: å…è´¹ã€å®æ—¶æ•°æ®
  â”œâ”€ æ”¯æŒ: è‚¡ç¥¨ã€èµ„é‡‘æµå‘
  â”œâ”€ é™åˆ¶: éå®˜æ–¹APIï¼Œä¸ç¨³å®š
  â””â”€ è®¤è¯: æ— éœ€è®¤è¯

âœ… è¯†åˆ«: 6ä½æ•°å­—ä»£ç 
  â”œâ”€ ä¸Šæµ·: 60xxxx, 68xxxx (å¦‚600519)
  â”œâ”€ æ·±åœ³: 00xxxx, 30xxxx (å¦‚000001)
  â””â”€ è‡ªåŠ¨æ·»åŠ äº¤æ˜“æ‰€å‰ç¼€
      * SH: ä¸Šæµ·è¯åˆ¸äº¤æ˜“æ‰€
      * SZ: æ·±åœ³è¯åˆ¸äº¤æ˜“æ‰€

Aè‚¡äº¤æ˜“ï¼ˆæ–°å¢ï¼‰:
âœ… æ¥æº: ä¸œæ–¹è´¢å¯Œå®¢æˆ·ç«¯
  â”œâ”€ æ–¹å¼: æ¨¡æ‹Ÿç‚¹å‡»/APIè°ƒç”¨
  â”œâ”€ æ”¯æŒ: ä¹°å–ã€æ’¤å•ã€æŸ¥è¯¢
  â”œâ”€ é™åˆ¶: éœ€è¦å®¢æˆ·ç«¯ç™»å½•
  â””â”€ å¤‡é€‰: åŒèŠ±é¡ºã€åˆ¸å•†API

ç»Ÿä¸€æ¥å£:
âœ… DataManagerè‡ªåŠ¨è¯†åˆ«ä¸‰ä¸ªå¸‚åœº
âœ… ç¼“å­˜æœºåˆ¶ç»Ÿä¸€
âœ… APIè°ƒç”¨ä¼˜åŒ–
âœ… äº¤æ˜“æ¥å£æŠ½è±¡
```

---

### **2. è‡ªåŠ¨åŒ–ä»»åŠ¡è°ƒåº¦**

```python
æ¯æ—¥å®šæ—¶ä»»åŠ¡:
ğŸ“… æ”¶ç›˜å(16:10) - æ¸¯è‚¡
   â”œâ”€ è·å–æœ€æ–°Kçº¿æ•°æ®
   â”œâ”€ è®¡ç®—TSF-LSMAæŒ‡æ ‡
   â”œâ”€ ç”Ÿæˆä¹°å–ä¿¡å·
   â”œâ”€ AIåŸºæœ¬é¢åˆ†æï¼ˆæ–°å¢ï¼‰
   â””â”€ å‘é€é€šçŸ¥

ğŸ“… æ”¶ç›˜å(15:05) - Aè‚¡ï¼ˆæ–°å¢ï¼‰
   â”œâ”€ è·å–æœ€æ–°Kçº¿æ•°æ®
   â”œâ”€ è®¡ç®—æŠ€æœ¯æŒ‡æ ‡
   â”œâ”€ ç”Ÿæˆä¹°å–ä¿¡å·
   â”œâ”€ AIèµ„é‡‘æµå‘åˆ†æ
   â””â”€ å‘é€é€šçŸ¥

ğŸ“… æ”¶ç›˜å(04:10) - ç¾è‚¡
   â”œâ”€ è·å–æœ€æ–°Kçº¿æ•°æ®
   â”œâ”€ è®¡ç®—TSF-LSMAæŒ‡æ ‡
   â”œâ”€ ç”Ÿæˆä¹°å–ä¿¡å·
   â”œâ”€ AIæ–°é—»æƒ…æ„Ÿåˆ†æï¼ˆæ–°å¢ï¼‰
   â””â”€ å‘é€é€šçŸ¥

å¼€ç›˜å‰(09:20) - æ¸¯è‚¡/Aè‚¡
   â”œâ”€ æ£€æŸ¥å¾…æ‰§è¡Œä¿¡å·
   â”œâ”€ AIä¿¡å·ç¡®è®¤ï¼ˆæ–°å¢ï¼‰
   â”œâ”€ è¿æ¥äº¤æ˜“è´¦æˆ·
   â”œâ”€ æ‰§è¡Œè‡ªåŠ¨äº¤æ˜“
   â””â”€ è®°å½•äº¤æ˜“æ—¥å¿—

å®ç°æ–¹å¼:
âœ… Windowsä»»åŠ¡è®¡åˆ’ç¨‹åº
âœ… Linux crontab
âœ… æˆ–UIå†…ç½®å®šæ—¶å™¨
```

---

### **3. AIåˆ†æå¼•æ“ï¼ˆæ–°å¢ï¼‰**

```python
AIåˆ†ææ¨¡å—:

ğŸ“Š åŸºæœ¬é¢åˆ†æ
â”œâ”€ å…¬å¸è´¢åŠ¡æ•°æ®åˆ†æ
â”œâ”€ è¡Œä¸šå¯¹æ¯”åˆ†æ
â”œâ”€ ä¼°å€¼åˆ†æ
â”œâ”€ æ­£é¢/è´Ÿé¢å› ç´ æå–
â””â”€ ç»¼åˆè¯„åˆ†ï¼ˆ0-100ï¼‰

ğŸ“° æ–°é—»æƒ…æ„Ÿåˆ†æ
â”œâ”€ æ–°é—»æŠ“å–
â”œâ”€ æƒ…æ„Ÿåˆ†æï¼ˆæ­£é¢/ä¸­æ€§/è´Ÿé¢ï¼‰
â”œâ”€ å½±å“è¯„ä¼°
â”œâ”€ å…³é”®äº‹ä»¶æå–
â””â”€ æŠ•èµ„å»ºè®®

ğŸ’¹ æŠ€æœ¯é¢åˆ†æ
â”œâ”€ æŠ€æœ¯å½¢æ€è¯†åˆ«
â”œâ”€ æ”¯æ’‘é˜»åŠ›ä½åˆ†æ
â”œâ”€ è¶‹åŠ¿åˆ¤æ–­
â”œâ”€ æˆäº¤é‡åˆ†æ
â””â”€ AIé¢„æµ‹ï¼ˆå¯é€‰ï¼‰

ğŸ¤– AIä¿¡å·ç¡®è®¤
â”œâ”€ éªŒè¯æŠ€æœ¯ä¿¡å·åˆç†æ€§
â”œâ”€ ç»“åˆåŸºæœ¬é¢åˆ¤æ–­
â”œâ”€ é£é™©è¯„ä¼°
â”œâ”€ å»ºè®®ä»“ä½
â””â”€ æ­¢æŸä½å»ºè®®

æ”¯æŒçš„AIæ¨¡å‹:
âœ… DeepSeek API
  â”œâ”€ ä¼˜åŠ¿: ä¾¿å®œã€é€Ÿåº¦å¿«
  â”œâ”€ é€‚ç”¨: æŠ€æœ¯åˆ†æã€ä¿¡å·ç¡®è®¤
  â”œâ”€ æˆæœ¬: Â¥0.001/åƒtokens
  â””â”€ é…ç½®: DEEPSEEK_API_KEY

âœ… ChatGPT API (OpenAI)
  â”œâ”€ ä¼˜åŠ¿: ç†è§£åŠ›å¼ºã€è¾“å‡ºè´¨é‡é«˜
  â”œâ”€ é€‚ç”¨: åŸºæœ¬é¢åˆ†æã€æ–°é—»è§£è¯»
  â”œâ”€ æˆæœ¬: $0.002/åƒtokens (GPT-4)
  â””â”€ é…ç½®: OPENAI_API_KEY

âœ… Claude API (Anthropic)
  â”œâ”€ ä¼˜åŠ¿: é•¿æ–‡æœ¬ã€é€»è¾‘æ¨ç†
  â”œâ”€ é€‚ç”¨: è´¢æŠ¥åˆ†æã€æ·±åº¦ç ”ç©¶
  â”œâ”€ æˆæœ¬: $0.003/åƒtokens
  â””â”€ é…ç½®: CLAUDE_API_KEY

âœ… é€šä¹‰åƒé—® API (é˜¿é‡Œ)
  â”œâ”€ ä¼˜åŠ¿: ä¸­æ–‡ç†è§£å¥½ã€Aè‚¡ä¸“ä¸š
  â”œâ”€ é€‚ç”¨: Aè‚¡åˆ†æã€æ”¿ç­–è§£è¯»
  â”œâ”€ æˆæœ¬: Â¥0.002/åƒtokens
  â””â”€ é…ç½®: QWEN_API_KEY

âœ… æ–‡å¿ƒä¸€è¨€ API (ç™¾åº¦)
  â”œâ”€ ä¼˜åŠ¿: ä¸­æ–‡ã€é‡‘èä¸“ä¸šçŸ¥è¯†
  â”œâ”€ é€‚ç”¨: Aè‚¡åˆ†æã€è´¢ç»æ–°é—»
  â”œâ”€ æˆæœ¬: Â¥0.002/åƒtokens
  â””â”€ é…ç½®: ERNIE_API_KEY

é…ç½®ä¼˜å…ˆçº§:
1. ç”¨æˆ·åœ¨UIä¸­é€‰æ‹©ä¸»åŠ›AI
2. æ ¹æ®ä»»åŠ¡ç±»å‹è‡ªåŠ¨é€‰æ‹©
   - æŠ€æœ¯åˆ†æ â†’ DeepSeekï¼ˆä¾¿å®œï¼‰
   - åŸºæœ¬é¢ â†’ ChatGPT/Claudeï¼ˆè´¨é‡é«˜ï¼‰
   - Aè‚¡åˆ†æ â†’ é€šä¹‰åƒé—®/æ–‡å¿ƒï¼ˆä¸­æ–‡å¥½ï¼‰
3. é™çº§ç­–ç•¥ï¼ˆä¸»APIå¤±è´¥æ—¶ï¼‰
   - ä¸»: DeepSeek â†’ å¤‡: ChatGPT
   - ä¸»: Claude â†’ å¤‡: ChatGPT
```

---

### **3. ç­–ç•¥å‚æ•°åŒ–**

```python
æ¯ä¸ªç­–ç•¥æ”¯æŒè‡ªå®šä¹‰å‚æ•°:

TSF-LSMAç­–ç•¥:
â”œâ”€ tsf_period: 9 (å¯è°ƒ)
â”œâ”€ lsma_period: 20 (å¯è°ƒ)
â”œâ”€ buy_threshold: 0.5% (å¯è°ƒ)
â”œâ”€ sell_threshold: 0.5% (å¯è°ƒ)
â””â”€ use_percent: True/False

MACDç­–ç•¥:
â”œâ”€ fast_period: 12
â”œâ”€ slow_period: 26
â”œâ”€ signal_period: 9
â””â”€ threshold: 0.0

RSIç­–ç•¥:
â”œâ”€ period: 14
â”œâ”€ overbought: 70
â”œâ”€ oversold: 30
â””â”€ ...

åœ¨UIä¸­å®ç°:
âœ… ç­–ç•¥é…ç½®å¯¹è¯æ¡†
âœ… å‚æ•°è¾“å…¥æ¡†
âœ… å®æ—¶å‚æ•°éªŒè¯
âœ… ä¿å­˜/åŠ è½½é…ç½®
```

---

## ğŸ“Š **æŠ€æœ¯æ ˆ**

### **æ–¹æ¡ˆ1ï¼šPyQt6ï¼ˆæ¨èï¼‰**

```python
ä¼˜åŠ¿:
âœ… æ€§èƒ½ä¼˜ç§€ï¼ŒåŸç”Ÿä½“éªŒ
âœ… å®Œæ•´çš„å›¾è¡¨åº“ï¼ˆpyqtgraphï¼‰
âœ… ä¸backtrader/futuå®Œç¾é›†æˆ
âœ… ç±»ä¼¼VNPYçš„ä¸“ä¸šé£æ ¼
âœ… è·¨å¹³å°

æŠ€æœ¯æ ˆ:
- PyQt6: ä¸»ç•Œé¢æ¡†æ¶
- pyqtgraph: å®æ—¶Kçº¿å›¾è¡¨
- pandas: æ•°æ®å¤„ç†
- matplotlib: é™æ€å›¾è¡¨
- backtrader: å›æµ‹å¼•æ“
- futu-api: äº¤æ˜“æ¥å£
```

---

### **æ–¹æ¡ˆ2ï¼šWebç•Œé¢**

```python
ä¼˜åŠ¿:
âœ… æ›´ç°ä»£çš„UI/UX
âœ… å“åº”å¼è®¾è®¡
âœ… å®¹æ˜“éƒ¨ç½²
âœ… æ›´ä¸°å¯Œçš„å›¾è¡¨

æŠ€æœ¯æ ˆ:
- FastAPI: åç«¯API
- React + TypeScript: å‰ç«¯
- TradingView Charts: å›¾è¡¨
- WebSocket: å®æ—¶æ•°æ®
- Tailwind CSS: æ ·å¼
```

---

## ğŸ¨ **ç•Œé¢å¸ƒå±€ï¼ˆPyQt6ï¼‰**

### **ä¸»çª—å£è®¾è®¡**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èœå•æ : æ–‡ä»¶ | ç­–ç•¥ | äº¤æ˜“ | å·¥å…· | å¸®åŠ©                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å·¥å…·æ : [è¿æ¥] [åˆ·æ–°] [å›æµ‹] [äº¤æ˜“] [ç­–ç•¥] [è®¾ç½®]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         â”‚                                 â”‚  æŒä»“ä¿¡æ¯      â”‚
â”‚ è‚¡ç¥¨åˆ—è¡¨â”‚       Kçº¿å›¾ + æŒ‡æ ‡               â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”â”‚                                 â”‚ â”‚TSLA  100è‚¡â”‚  â”‚
â”‚ â”‚TSLA â”‚â”‚                                 â”‚ â”‚æˆæœ¬ $420  â”‚  â”‚
â”‚ â”‚NVDA â”‚â”‚                                 â”‚ â”‚ç›ˆäº +5.2% â”‚  â”‚
â”‚ â”‚AAPL â”‚â”‚                                 â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â”‚01797â”‚â”‚                                 â”‚                â”‚
â”‚ â””â”€â”€â”€â”€â”€â”˜â”‚                                 â”‚  è´¦æˆ·ä¿¡æ¯      â”‚
â”‚        â”‚                                 â”‚ æ€»èµ„äº§: $100K  â”‚
â”‚ è‡ªé€‰è‚¡ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ å¯ç”¨: $50K     â”‚
â”‚        â”‚  ä¿¡å·é¢æ¿                        â”‚ æŒä»“: $50K     â”‚
â”‚ [æ–°å¢] â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                â”‚
â”‚ [åˆ é™¤] â”‚ â”‚ğŸŸ¢ TSLA ä¹°å…¥ä¿¡å·            â”‚   â”‚  æœ€æ–°æ–°é—»      â”‚
â”‚        â”‚ â”‚  TSF > LSMA + 0.5%        â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚        â”‚ â”‚  å»ºè®®ä»·: $420-$435        â”‚   â”‚ â”‚Teslaå‘å¸ƒ  â”‚   â”‚
â”‚        â”‚ â”‚  [ç«‹å³äº¤æ˜“] [æŸ¥çœ‹è¯¦æƒ…]     â”‚   â”‚ â”‚æ–°è½¦å‹...   â”‚   â”‚
â”‚        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  çŠ¶æ€æ : âœ… å·²è¿æ¥ | æœ€åæ›´æ–°: 10:30 | CPU: 5% | å†…å­˜: 2GBâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ **é¡¹ç›®ç»“æ„ï¼ˆåŸºäºç°æœ‰ä»£ç ï¼‰**

```
F:\PyProjects\futu_backtest_trader\
â”œâ”€â”€ main.py                        # æ–°å¢ï¼šä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ requirements.txt               # ä¾èµ–ç®¡ç†
â”œâ”€â”€ .env                          # APIå¯†é’¥é…ç½®
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py               # ç°æœ‰ï¼šé…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ themes.py                 # æ–°å¢ï¼šUIä¸»é¢˜
â”œâ”€â”€ ui/                           # æ–°å¢ï¼šUIæ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main_window.py            # ä¸»çª—å£
â”‚   â””â”€â”€ widgets/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ stock_list.py         # è‚¡ç¥¨åˆ—è¡¨
â”‚       â”œâ”€â”€ chart_widget.py       # Kçº¿å›¾
â”‚       â”œâ”€â”€ signal_panel.py       # ä¿¡å·é¢æ¿
â”‚       â”œâ”€â”€ position_widget.py    # æŒä»“
â”‚       â”œâ”€â”€ news_widget.py        # æ–°é—»
â”‚       â”œâ”€â”€ backtest_widget.py    # å›æµ‹
â”‚       â”œâ”€â”€ trade_widget.py       # äº¤æ˜“
â”‚       â””â”€â”€ scheduler_widget.py   # æ–°å¢ï¼šå®šæ—¶ä»»åŠ¡
â”œâ”€â”€ core/                         # æ–°å¢ï¼šæ ¸å¿ƒå¼•æ“
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ data_manager.py           # æ•°æ®ç®¡ç†ï¼ˆç»Ÿä¸€æ¥å£ï¼‰
â”‚   â”œâ”€â”€ strategy_engine.py        # ç­–ç•¥å¼•æ“
â”‚   â”œâ”€â”€ trade_engine.py           # äº¤æ˜“å¼•æ“
â”‚   â”œâ”€â”€ signal_generator.py       # ä¿¡å·ç”Ÿæˆ
â”‚   â”œâ”€â”€ scheduler.py              # å®šæ—¶ä»»åŠ¡è°ƒåº¦
â”‚   â”œâ”€â”€ news_fetcher.py           # æ–°é—»è·å–
â”‚   â””â”€â”€ fundamental_analyzer.py   # åŸºæœ¬é¢åˆ†æ
â”œâ”€â”€ data/                         # ç°æœ‰ï¼šæ•°æ®æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ futu_data.py              # ç°æœ‰ï¼šFutuæ•°æ®
â”‚   â””â”€â”€ financial_data.py         # æ–°å¢ï¼šFinancial Datasets
â”œâ”€â”€ data_cache.py                 # ç°æœ‰ï¼šç¼“å­˜ç³»ç»Ÿ
â”œâ”€â”€ strategies/                   # ç°æœ‰ï¼šç­–ç•¥æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_strategy.py          # æ–°å¢ï¼šç­–ç•¥åŸºç±»
â”‚   â”œâ”€â”€ tsf_lsma_strategy.py      # ç°æœ‰ï¼šTSF-LSMA
â”‚   â”œâ”€â”€ tsf_lsma_strategy_percent.py  # ç°æœ‰ï¼šç™¾åˆ†æ¯”ç‰ˆæœ¬
â”‚   â”œâ”€â”€ macd_strategy.py          # ç°æœ‰ï¼šMACD
â”‚   â””â”€â”€ rsi_strategy.py           # æ–°å¢ï¼šRSI
â”œâ”€â”€ signals/                      # ç°æœ‰ä¿¡å·ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ daily_signal_tsla.py      # ç°æœ‰ï¼šTSLAä¿¡å·
â”‚   â”œâ”€â”€ daily_signal_01797.py     # ç°æœ‰ï¼š01797ä¿¡å·
â”‚   â””â”€â”€ signal_base.py            # æ–°å¢ï¼šä¿¡å·åŸºç±»
â”œâ”€â”€ live_trading/                 # ç°æœ‰ï¼šå®ç›˜äº¤æ˜“
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ trader.py                 # ç°æœ‰ï¼šäº¤æ˜“å™¨
â”‚   â”œâ”€â”€ hk_trader.py              # ç°æœ‰ï¼šæ¸¯è‚¡äº¤æ˜“
â”‚   â””â”€â”€ us_trader.py              # ç°æœ‰ï¼šç¾è‚¡äº¤æ˜“
â”œâ”€â”€ backtester/                   # ç°æœ‰ï¼šå›æµ‹å¼•æ“
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ backtest_engine.py
â”œâ”€â”€ utils/                        # å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ logger.py                 # æ–°å¢ï¼šæ—¥å¿—
â”‚   â”œâ”€â”€ database.py               # æ–°å¢ï¼šæ•°æ®åº“
â”‚   â””â”€â”€ helpers.py                # æ–°å¢ï¼šè¾…åŠ©å‡½æ•°
â””â”€â”€ resources/                    # æ–°å¢ï¼šèµ„æºæ–‡ä»¶
    â”œâ”€â”€ icons/                    # å›¾æ ‡
    â”œâ”€â”€ styles/                   # æ ·å¼è¡¨
    â””â”€â”€ config/                   # é…ç½®æ¨¡æ¿
```

---

## ğŸ’» **æ ¸å¿ƒæ¨¡å—è®¾è®¡**

### **1. æ•°æ®ç®¡ç†å™¨ (core/data_manager.py)**

```python
"""
ç»Ÿä¸€æ•°æ®ç®¡ç†æ¥å£
è‡ªåŠ¨è¯†åˆ«ç¾è‚¡/æ¸¯è‚¡ï¼Œè°ƒç”¨å¯¹åº”API
"""
from data.futu_data import FutuDataFetcher
from data.financial_data import FinancialDatasetsAPI
from data_cache import get_cache


class DataManager:
    """ç»Ÿä¸€æ•°æ®ç®¡ç†å™¨"""
    
    def __init__(self):
        # åˆå§‹åŒ–æ•°æ®æº
        self.futu_fetcher = FutuDataFetcher()
        self.financial_api = FinancialDatasetsAPI()
        self.cache = get_cache()
        
        # è¿æ¥çŠ¶æ€
        self.futu_connected = False
    
    def is_hk_stock(self, stock_code):
        """åˆ¤æ–­æ˜¯å¦æ¸¯è‚¡"""
        return stock_code.startswith('HK.')
    
    def is_us_stock(self, stock_code):
        """åˆ¤æ–­æ˜¯å¦ç¾è‚¡"""
        return not self.is_hk_stock(stock_code)
    
    def get_kline_data(self, stock_code, start_date, end_date,
                      use_cache=True, force_update=False):
        """
        è·å–Kçº¿æ•°æ®ï¼ˆè‡ªåŠ¨è¯†åˆ«æ•°æ®æºï¼‰
        
        Parameters:
        -----------
        stock_code : str
            è‚¡ç¥¨ä»£ç 
            - æ¸¯è‚¡: HK.01797, HK.00700
            - ç¾è‚¡: TSLA, NVDA, AAPL
        start_date : str
            å¼€å§‹æ—¥æœŸ
        end_date : str
            ç»“æŸæ—¥æœŸ
        use_cache : bool
            æ˜¯å¦ä½¿ç”¨ç¼“å­˜
        force_update : bool
            æ˜¯å¦å¼ºåˆ¶æ›´æ–°
        
        Returns:
        --------
        DataFrame : Kçº¿æ•°æ®
        """
        # å…ˆå°è¯•ä»ç¼“å­˜åŠ è½½
        if use_cache and not force_update:
            cached_data = self.cache.get_prices(
                stock_code, start_date, end_date
            )
            if cached_data is not None:
                return cached_data
        
        # ä»APIè·å–
        if self.is_hk_stock(stock_code):
            # æ¸¯è‚¡ - ä½¿ç”¨Futu
            if not self.futu_connected:
                self.futu_fetcher.connect()
                self.futu_connected = True
            
            df = self.futu_fetcher.get_history_kline(
                stock_code, start_date, end_date
            )
        else:
            # ç¾è‚¡ - ä½¿ç”¨Financial Datasets
            df = self.financial_api.get_stock_prices(
                stock_code, start_date, end_date
            )
        
        # ä¿å­˜åˆ°ç¼“å­˜
        if df is not None and use_cache:
            self.cache.set_prices(stock_code, df)
        
        return df
    
    def get_current_price(self, stock_code):
        """è·å–å½“å‰ä»·æ ¼"""
        if self.is_hk_stock(stock_code):
            # æ¸¯è‚¡å®æ—¶ä»·æ ¼
            if not self.futu_connected:
                self.futu_fetcher.connect()
                self.futu_connected = True
            return self.futu_fetcher.get_realtime_price(stock_code)
        else:
            # ç¾è‚¡ä½¿ç”¨æœ€æ–°æ”¶ç›˜ä»·
            df = self.get_kline_data(
                stock_code,
                (datetime.now() - timedelta(days=7)).strftime('%Y-%m-%d'),
                datetime.now().strftime('%Y-%m-%d')
            )
            if df is not None and len(df) > 0:
                return df['close'].iloc[-1]
        return None
    
    def get_news(self, stock_code):
        """è·å–æ–°é—»"""
        # TODO: å®ç°æ–°é—»è·å–
        pass
    
    def disconnect(self):
        """æ–­å¼€è¿æ¥"""
        if self.futu_connected:
            self.futu_fetcher.disconnect()
            self.futu_connected = False
```

---

### **2. ç­–ç•¥å¼•æ“ (core/strategy_engine.py)**

```python
"""
ç­–ç•¥å¼•æ“
ç®¡ç†å¤šä¸ªç­–ç•¥ï¼Œç”Ÿæˆäº¤æ˜“ä¿¡å·
"""
from strategies.tsf_lsma_strategy_percent import TSFLSMAStrategy
from strategies.macd_strategy import MACDStrategy
from strategies.rsi_strategy import RSIStrategy


class StrategyEngine:
    """ç­–ç•¥å¼•æ“"""
    
    def __init__(self):
        # å·²æ³¨å†Œçš„ç­–ç•¥
        self.strategies = {}
        
        # æ³¨å†Œé»˜è®¤ç­–ç•¥
        self.register_strategy('TSF-LSMA', TSFLSMAStrategy)
        self.register_strategy('MACD', MACDStrategy)
        self.register_strategy('RSI', RSIStrategy)
        
        # å½“å‰æ¿€æ´»çš„ç­–ç•¥
        self.active_strategies = {}
    
    def register_strategy(self, name, strategy_class):
        """æ³¨å†Œç­–ç•¥"""
        self.strategies[name] = strategy_class
    
    def activate_strategy(self, stock_code, strategy_name, params):
        """
        æ¿€æ´»ç­–ç•¥
        
        Parameters:
        -----------
        stock_code : str
            è‚¡ç¥¨ä»£ç 
        strategy_name : str
            ç­–ç•¥åç§°
        params : dict
            ç­–ç•¥å‚æ•°
            ä¾‹å¦‚: {
                'tsf_period': 9,
                'lsma_period': 20,
                'buy_threshold_pct': 0.5,
                'sell_threshold_pct': 0.5
            }
        """
        if strategy_name not in self.strategies:
            raise ValueError(f"ç­–ç•¥ {strategy_name} æœªæ³¨å†Œ")
        
        # åˆ›å»ºç­–ç•¥å®ä¾‹
        strategy_class = self.strategies[strategy_name]
        strategy = strategy_class(**params)
        
        # ä¿å­˜åˆ°æ¿€æ´»åˆ—è¡¨
        key = f"{stock_code}_{strategy_name}"
        self.active_strategies[key] = {
            'stock_code': stock_code,
            'strategy': strategy,
            'params': params
        }
    
    def generate_signal(self, stock_code, df):
        """
        ç”Ÿæˆäº¤æ˜“ä¿¡å·
        
        Parameters:
        -----------
        stock_code : str
            è‚¡ç¥¨ä»£ç 
        df : DataFrame
            Kçº¿æ•°æ®
        
        Returns:
        --------
        dict : ä¿¡å·ä¿¡æ¯
            {
                'stock': 'TSLA',
                'type': 'BUY',  # BUY/SELL/HOLD
                'reason': 'TSF > LSMA + 0.5%',
                'current_price': 420.0,
                'suggest_price_min': 415.0,
                'suggest_price_max': 425.0,
                'time': '2025-01-22 16:00:00',
                'strategy': 'TSF-LSMA',
                'params': {...}
            }
        """
        # éå†æ‰€æœ‰æ¿€æ´»çš„ç­–ç•¥
        signals = []
        
        for key, info in self.active_strategies.items():
            if info['stock_code'] == stock_code:
                strategy = info['strategy']
                signal = strategy.analyze(df)
                
                if signal:
                    signal['stock'] = stock_code
                    signal['strategy'] = key.split('_')[1]
                    signal['params'] = info['params']
                    signal['time'] = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
                    signals.append(signal)
        
        return signals
    
    def get_strategy_params(self, strategy_name):
        """è·å–ç­–ç•¥é»˜è®¤å‚æ•°"""
        if strategy_name not in self.strategies:
            return {}
        
        strategy_class = self.strategies[strategy_name]
        return strategy_class.get_default_params()
```

---

### **3. å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨ (core/scheduler.py)**

```python
"""
å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨
æ”¯æŒæ¯æ—¥è‡ªåŠ¨ä¿¡å·ç”Ÿæˆå’Œäº¤æ˜“
"""
import schedule
import time
from datetime import datetime
import threading


class TaskScheduler:
    """ä»»åŠ¡è°ƒåº¦å™¨"""
    
    def __init__(self, data_manager, strategy_engine, trade_engine):
        self.data_manager = data_manager
        self.strategy_engine = strategy_engine
        self.trade_engine = trade_engine
        
        # ä»»åŠ¡åˆ—è¡¨
        self.tasks = {}
        
        # è¿è¡Œæ ‡å¿—
        self.running = False
        self.thread = None
    
    def add_daily_signal_task(self, stock_code, time_str, strategy_name, params):
        """
        æ·»åŠ æ¯æ—¥ä¿¡å·ç”Ÿæˆä»»åŠ¡
        
        Parameters:
        -----------
        stock_code : str
            è‚¡ç¥¨ä»£ç 
        time_str : str
            æ‰§è¡Œæ—¶é—´ï¼Œå¦‚ "16:10"ï¼ˆæ¸¯è‚¡æ”¶ç›˜ï¼‰æˆ– "04:10"ï¼ˆç¾è‚¡æ”¶ç›˜ï¼‰
        strategy_name : str
            ç­–ç•¥åç§°
        params : dict
            ç­–ç•¥å‚æ•°
        """
        task_id = f"signal_{stock_code}_{time_str}"
        
        def job():
            print(f"\n{'='*70}")
            print(f"æ‰§è¡Œæ¯æ—¥ä¿¡å·ä»»åŠ¡: {stock_code}")
            print(f"æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
            print(f"{'='*70}\n")
            
            # è·å–æ•°æ®
            end_date = datetime.now().strftime('%Y-%m-%d')
            start_date = (datetime.now() - timedelta(days=60)).strftime('%Y-%m-%d')
            
            df = self.data_manager.get_kline_data(
                stock_code, start_date, end_date
            )
            
            if df is None:
                print(f"âŒ è·å–æ•°æ®å¤±è´¥")
                return
            
            # ç”Ÿæˆä¿¡å·
            signals = self.strategy_engine.generate_signal(stock_code, df)
            
            if signals:
                for signal in signals:
                    print(f"\nğŸ”” {signal['type']} ä¿¡å·")
                    print(f"   åŸå› : {signal['reason']}")
                    print(f"   å½“å‰ä»·: ${signal['current_price']:.2f}")
                    print(f"   å»ºè®®ä»·: ${signal['suggest_price_min']:.2f} - ${signal['suggest_price_max']:.2f}")
                    
                    # å‘é€é€šçŸ¥
                    self.send_notification(signal)
            else:
                print(f"âšª æ— ä¿¡å·")
        
        # æ·»åŠ å®šæ—¶ä»»åŠ¡
        schedule.every().day.at(time_str).do(job)
        self.tasks[task_id] = {
            'stock_code': stock_code,
            'time': time_str,
            'strategy': strategy_name,
            'params': params
        }
        
        print(f"âœ… å·²æ·»åŠ æ¯æ—¥ä»»åŠ¡: {stock_code} at {time_str}")
    
    def add_auto_trade_task(self, stock_code, time_str, enable=True):
        """
        æ·»åŠ è‡ªåŠ¨äº¤æ˜“ä»»åŠ¡
        
        Parameters:
        -----------
        stock_code : str
            è‚¡ç¥¨ä»£ç 
        time_str : str
            æ‰§è¡Œæ—¶é—´ï¼Œå¦‚ "09:25"ï¼ˆå¼€ç›˜å‰ï¼‰
        enable : bool
            æ˜¯å¦å¯ç”¨
        """
        task_id = f"trade_{stock_code}_{time_str}"
        
        def job():
            if not enable:
                return
            
            print(f"\n{'='*70}")
            print(f"æ‰§è¡Œè‡ªåŠ¨äº¤æ˜“ä»»åŠ¡: {stock_code}")
            print(f"æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
            print(f"{'='*70}\n")
            
            # æ£€æŸ¥æ˜¯å¦æœ‰å¾…æ‰§è¡Œçš„ä¿¡å·
            # TODO: ä»æ•°æ®åº“æˆ–ç¼“å­˜ä¸­è·å–æ˜¨æ—¥ä¿¡å·
            
            # æ‰§è¡Œäº¤æ˜“
            # TODO: è°ƒç”¨trade_engineæ‰§è¡Œ
        
        schedule.every().day.at(time_str).do(job)
        self.tasks[task_id] = {
            'stock_code': stock_code,
            'time': time_str,
            'type': 'auto_trade',
            'enable': enable
        }
        
        print(f"âœ… å·²æ·»åŠ è‡ªåŠ¨äº¤æ˜“ä»»åŠ¡: {stock_code} at {time_str}")
    
    def start(self):
        """å¯åŠ¨è°ƒåº¦å™¨"""
        if self.running:
            print("âš ï¸  è°ƒåº¦å™¨å·²åœ¨è¿è¡Œ")
            return
        
        self.running = True
        
        def run_schedule():
            while self.running:
                schedule.run_pending()
                time.sleep(60)  # æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
        
        self.thread = threading.Thread(target=run_schedule, daemon=True)
        self.thread.start()
        
        print("âœ… è°ƒåº¦å™¨å·²å¯åŠ¨")
    
    def stop(self):
        """åœæ­¢è°ƒåº¦å™¨"""
        self.running = False
        if self.thread:
            self.thread.join(timeout=5)
        print("âœ… è°ƒåº¦å™¨å·²åœæ­¢")
    
    def send_notification(self, signal):
        """å‘é€é€šçŸ¥"""
        # TODO: å®ç°æ¡Œé¢é€šçŸ¥ã€é‚®ä»¶é€šçŸ¥ç­‰
        pass
    
    def list_tasks(self):
        """åˆ—å‡ºæ‰€æœ‰ä»»åŠ¡"""
        return self.tasks
```

---

## ğŸ’» **æ ¸å¿ƒç»„ä»¶**

### **1. ä¸»çª—å£ (MainWindow)**

```python
åŠŸèƒ½:
- èœå•æ ï¼šæ–‡ä»¶ã€ç­–ç•¥ã€äº¤æ˜“ã€å·¥å…·ã€å¸®åŠ©
- å·¥å…·æ ï¼šå¿«æ·æ“ä½œæŒ‰é’®
- ä¸­å¤®åŒºåŸŸï¼šä¸‰æ å¸ƒå±€
- çŠ¶æ€æ ï¼šè¿æ¥çŠ¶æ€ã€æ›´æ–°æ—¶é—´

ç‰¹ç‚¹:
- å¯æ‹–æ‹½è°ƒæ•´å¸ƒå±€
- æ”¯æŒå¤šä¸»é¢˜
- å¿«æ·é”®æ”¯æŒ
- å®šæ—¶å™¨æ›´æ–°
```

---

### **2. Kçº¿å›¾è¡¨ (ChartWidget)**

```python
åŠŸèƒ½:
- å®æ—¶Kçº¿æ˜¾ç¤º
- å¤šå‘¨æœŸåˆ‡æ¢ï¼ˆæ—¥Kã€60åˆ†ã€15åˆ†ï¼‰
- æŒ‡æ ‡å åŠ ï¼ˆTSFã€LSMAã€MACDã€RSIï¼‰
- ä¹°å–ä¿¡å·æ ‡æ³¨
- æˆäº¤é‡æ˜¾ç¤º

æŠ€æœ¯:
- pyqtgraphç»˜åˆ¶
- åŒå‡»ç¼©æ”¾
- é¼ æ ‡æ‚¬åœæ˜¾ç¤ºè¯¦æƒ…
- æ”¯æŒä¿å­˜æˆªå›¾
```

---

### **3. ä¿¡å·é¢æ¿ (SignalPanel)**

```python
åŠŸèƒ½:
- å®æ—¶ä¿¡å·æ¨é€
- ä¿¡å·ç±»å‹ï¼šğŸŸ¢ä¹°å…¥ ğŸ”´å–å‡º âšªè§‚æœ›
- ä¿¡å·è¯¦æƒ…ï¼šåŸå› ã€ä»·æ ¼ã€å»ºè®®
- ä¸€é”®äº¤æ˜“æŒ‰é’®

ç‰¹ç‚¹:
- å¡ç‰‡å¼è®¾è®¡
- æœ€å¤šæ˜¾ç¤º10æ¡
- æ”¯æŒç­›é€‰
- å†å²è®°å½•
```

---

### **4. æŒä»“ç»„ä»¶ (PositionWidget)**

```python
åŠŸèƒ½:
- è´¦æˆ·æ€»è§ˆ
  - æ€»èµ„äº§
  - å¯ç”¨èµ„é‡‘
  - æŒä»“å¸‚å€¼
  - æ€»ç›ˆäº
  
- æŒä»“åˆ—è¡¨
  - è‚¡ç¥¨ä»£ç 
  - æŒä»“æ•°é‡
  - æˆæœ¬ä»·
  - å½“å‰ä»·
  - ç›ˆäºï¼ˆé‡‘é¢å’Œç™¾åˆ†æ¯”ï¼‰

ç‰¹ç‚¹:
- å®æ—¶æ›´æ–°
- ç›ˆäºå½©è‰²æ˜¾ç¤º
- æ”¯æŒæ’åº
```

---

### **5. æ–°é—»ç»„ä»¶ (NewsWidget)**

```python
åŠŸèƒ½:
- æ ‡ç­¾é¡µ1ï¼šæœ€æ–°æ–°é—»
  - æ–°é—»æ ‡é¢˜
  - æ–°é—»æ‘˜è¦
  - æ¥æºå’Œæ—¶é—´
  - ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…
  
- æ ‡ç­¾é¡µ2ï¼šåŸºæœ¬é¢åˆ†æ
  - âœ… æ­£é¢å› ç´ 
  - âŒ è´Ÿé¢å› ç´ 
  - ç»¼åˆè¯„åˆ†ï¼ˆ0-100ï¼‰

æ•°æ®æ¥æº:
- æ–°é—»APIï¼ˆNewsAPIã€Alpha Vantageï¼‰
- AIåˆ†æï¼ˆClaude APIï¼‰
```

---

### **6. å›æµ‹ç»„ä»¶ (BacktestWidget)**

```python
åŠŸèƒ½:
- ç­–ç•¥é€‰æ‹©ï¼ˆTSF-LSMAã€MACDã€RSIï¼‰
- å‚æ•°é…ç½®
  - è‚¡ç¥¨ä»£ç 
  - æ—¥æœŸèŒƒå›´
  - åˆå§‹èµ„é‡‘
  - ç­–ç•¥å‚æ•°
  
- å›æµ‹æ‰§è¡Œ
- ç»“æœå±•ç¤º
  - æ”¶ç›Šæ›²çº¿
  - äº¤æ˜“è®°å½•
  - æ€§èƒ½æŒ‡æ ‡

ç‰¹ç‚¹:
- å¤šç­–ç•¥å¯¹æ¯”
- å‚æ•°ä¼˜åŒ–
- æŠ¥å‘Šå¯¼å‡º
```

---

### **7. äº¤æ˜“ç»„ä»¶ (TradeWidget)**

```python
åŠŸèƒ½:
- æ‰‹åŠ¨äº¤æ˜“
  - ä¹°å…¥/å–å‡º
  - é™ä»·/å¸‚ä»·
  - æ•°é‡è¾“å…¥
  - ä»·æ ¼è¾“å…¥
  
- è‡ªåŠ¨äº¤æ˜“
  - å¯åŠ¨/åœæ­¢
  - ç­–ç•¥é€‰æ‹©
  - é£æ§è®¾ç½®
  
- è®¢å•ç®¡ç†
  - å½“å‰å§”æ‰˜
  - å†å²æˆäº¤
  - æ’¤å•åŠŸèƒ½

è¿æ¥:
- Futu OpenD
- æ¨¡æ‹Ÿç›˜/çœŸå®ç›˜
```

---

## ğŸ”„ **æ•°æ®æµç¨‹**

```
ç”¨æˆ·æ“ä½œ
   â†“
MainWindow (ä¸»çª—å£)
   â†“
â”œâ”€ DataManager (æ•°æ®ç®¡ç†)
â”‚  â”œâ”€ Futu API â†’ Kçº¿ã€è¡Œæƒ…
â”‚  â”œâ”€ Financial Datasets API â†’ å†å²æ•°æ®
â”‚  â”œâ”€ News API â†’ æ–°é—»
â”‚  â””â”€ Cache â†’ æœ¬åœ°ç¼“å­˜
â”‚
â”œâ”€ StrategyEngine (ç­–ç•¥å¼•æ“)
â”‚  â”œâ”€ TSF-LSMA â†’ ä¿¡å·ç”Ÿæˆ
â”‚  â”œâ”€ MACD â†’ ä¿¡å·ç”Ÿæˆ
â”‚  â”œâ”€ RSI â†’ ä¿¡å·ç”Ÿæˆ
â”‚  â””â”€ è‡ªå®šä¹‰ç­–ç•¥
â”‚
â”œâ”€ TradeEngine (äº¤æ˜“å¼•æ“)
â”‚  â”œâ”€ Futu Connection â†’ è¿æ¥ç®¡ç†
â”‚  â”œâ”€ Order Manager â†’ è®¢å•ç®¡ç†
â”‚  â”œâ”€ Position Manager â†’ æŒä»“ç®¡ç†
â”‚  â””â”€ Risk Control â†’ é£æ§
â”‚
â””â”€ UI Components (UIç»„ä»¶)
   â”œâ”€ ChartWidget â†’ å›¾è¡¨æ˜¾ç¤º
   â”œâ”€ SignalPanel â†’ ä¿¡å·æ˜¾ç¤º
   â”œâ”€ PositionWidget â†’ æŒä»“æ˜¾ç¤º
   â”œâ”€ NewsWidget â†’ æ–°é—»æ˜¾ç¤º
   â””â”€ BacktestWidget â†’ å›æµ‹ç•Œé¢
```

---

## ğŸ¨ **ä¸»é¢˜è®¾è®¡**

### **æš—è‰²ä¸»é¢˜ï¼ˆé»˜è®¤ï¼‰**

```python
é…è‰²æ–¹æ¡ˆ:
- èƒŒæ™¯è‰²: #1e1e1e (æ·±é»‘)
- é¢æ¿è‰²: #2d2d2d (ä¸­é»‘)
- è¾¹æ¡†è‰²: #3d3d3d (æµ…é»‘)
- æ–‡å­—è‰²: #ffffff (ç™½è‰²)
- å¼ºè°ƒè‰²: #4CAF50 (ç»¿è‰²)
- è­¦å‘Šè‰²: #ff9800 (æ©™è‰²)
- é”™è¯¯è‰²: #f44336 (çº¢è‰²)

å›¾è¡¨é…è‰²:
- é˜³çº¿: #00ff00
- é˜´çº¿: #ff0000
- TSFçº¿: #00ff00
- LSMAçº¿: #ff0000
- æˆäº¤é‡: #0080ff
```

---

### **äº®è‰²ä¸»é¢˜**

```python
é…è‰²æ–¹æ¡ˆ:
- èƒŒæ™¯è‰²: #ffffff
- é¢æ¿è‰²: #f5f5f5
- è¾¹æ¡†è‰²: #e0e0e0
- æ–‡å­—è‰²: #000000

ï¼ˆå¯é€‰ï¼‰
```

---

## ğŸ“Š **åŠŸèƒ½ç‰¹æ€§**

### **å›æµ‹åŠŸèƒ½**

```python
1. å•ç­–ç•¥å›æµ‹
   - é€‰æ‹©ç­–ç•¥
   - è®¾ç½®å‚æ•°
   - æ‰§è¡Œå›æµ‹
   - æŸ¥çœ‹ç»“æœ

2. å¤šç­–ç•¥å¯¹æ¯”
   - åŒæ—¶å›æµ‹3ä¸ªç­–ç•¥
   - å¹¶æ’æ˜¾ç¤ºç»“æœ
   - æ€§èƒ½å¯¹æ¯”è¡¨

3. å‚æ•°ä¼˜åŒ–
   - ç½‘æ ¼æœç´¢
   - æµ‹è¯•36ç§ç»„åˆ
   - æ‰¾å‡ºæœ€ä¼˜å‚æ•°

4. å›æµ‹æŠ¥å‘Š
   - PDFå¯¼å‡º
   - Excelæ•°æ®
   - å›¾è¡¨æˆªå›¾
```

---

### **è‡ªåŠ¨äº¤æ˜“**

```python
1. ç­–ç•¥è‡ªåŠ¨äº¤æ˜“
   - é€‰æ‹©ç­–ç•¥
   - è®¾ç½®å‚æ•°
   - å¯åŠ¨äº¤æ˜“
   - å®æ—¶ç›‘æ§

2. ä¿¡å·è·Ÿéš
   - ç›‘å¬ä¿¡å·
   - è‡ªåŠ¨ä¸‹å•
   - é£æ§æ£€æŸ¥
   - æ—¥å¿—è®°å½•

3. é£é™©æ§åˆ¶
   - å•ç¬”æ­¢æŸ
   - æ€»æ­¢æŸ
   - ä»“ä½é™åˆ¶
   - èµ„é‡‘ç®¡ç†

4. äº¤æ˜“æ—¥å¿—
   - æ¯ç¬”äº¤æ˜“è®°å½•
   - ç›ˆäºç»Ÿè®¡
   - æ€§èƒ½åˆ†æ
```

---

### **ä¿¡å·æé†’**

```python
1. æ¡Œé¢é€šçŸ¥
   - ä¹°å…¥ä¿¡å·æé†’
   - å–å‡ºä¿¡å·æé†’
   - é‡è¦æ–°é—»æé†’

2. é‚®ä»¶é€šçŸ¥
   - æ¯æ—¥ä¿¡å·æ±‡æ€»
   - äº¤æ˜“æ‰§è¡Œé€šçŸ¥
   - å¼‚å¸¸æƒ…å†µè­¦å‘Š

3. å¾®ä¿¡é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
   - é€šè¿‡Serveré…±
   - å®æ—¶æ¨é€
```

---

### **æ–°é—»å’ŒåŸºæœ¬é¢**

```python
1. æ–°é—»è·å–
   - å®æ—¶æ–°é—»
   - ç›¸å…³åº¦æ’åº
   - æ¥æºæ ‡æ³¨

2. åŸºæœ¬é¢åˆ†æ
   - æ­£é¢å› ç´ 
   - è´Ÿé¢å› ç´ 
   - ç»¼åˆè¯„åˆ†

3. AIåˆ†æï¼ˆå¯é€‰ï¼‰
   - ä½¿ç”¨Claude API
   - æƒ…æ„Ÿåˆ†æ
   - å½±å“è¯„ä¼°
```

---

## ğŸš€ **å®ç°è®¡åˆ’**

### **Phase 1 - åŸºç¡€æ¡†æ¶ï¼ˆ2å‘¨ï¼‰**

```python
Week 1:
âœ… ä¸»çª—å£æ¡†æ¶
âœ… åŸºæœ¬å¸ƒå±€
âœ… èœå•å’Œå·¥å…·æ 
âœ… æš—è‰²ä¸»é¢˜

Week 2:
âœ… Kçº¿å›¾è¡¨åŸºç¡€
âœ… è‚¡ç¥¨åˆ—è¡¨
âœ… æ•°æ®è·å–
âœ… ç¼“å­˜ç³»ç»Ÿ
```

---

### **Phase 2 - ç­–ç•¥å›æµ‹ï¼ˆ2å‘¨ï¼‰**

```python
Week 3:
âœ… å›æµ‹ç•Œé¢
âœ… TSF-LSMAç­–ç•¥é›†æˆ
âœ… å‚æ•°é…ç½®
âœ… å›æµ‹æ‰§è¡Œ

Week 4:
âœ… ç»“æœå±•ç¤º
âœ… æ€§èƒ½æŒ‡æ ‡
âœ… å‚æ•°ä¼˜åŒ–
âœ… æŠ¥å‘Šå¯¼å‡º
```

---

### **Phase 3 - äº¤æ˜“åŠŸèƒ½ï¼ˆ2å‘¨ï¼‰**

```python
Week 5:
âœ… Futuè¿æ¥
âœ… æ‰‹åŠ¨äº¤æ˜“ç•Œé¢
âœ… è®¢å•ç®¡ç†
âœ… æŒä»“æ˜¾ç¤º

Week 6:
âœ… è‡ªåŠ¨äº¤æ˜“
âœ… ä¿¡å·è·Ÿéš
âœ… é£æ§ç³»ç»Ÿ
âœ… äº¤æ˜“æ—¥å¿—
```

---

### **Phase 4 - è¾…åŠ©åŠŸèƒ½ï¼ˆ1å‘¨ï¼‰**

```python
Week 7:
âœ… æ–°é—»è·å–
âœ… åŸºæœ¬é¢åˆ†æ
âœ… ä¿¡å·æé†’
âœ… æ•°æ®å¯¼å‡º
âœ… å®Œå–„æ–‡æ¡£
```

---

## ğŸ“¦ **ä¾èµ–å®‰è£…**

```bash
# PyQt6æ–¹æ¡ˆ
pip install PyQt6
pip install pyqtgraph
pip install pandas numpy
pip install matplotlib
pip install backtrader
pip install futu-api
pip install requests
pip install python-dotenv

# Webæ–¹æ¡ˆï¼ˆå¯é€‰ï¼‰
pip install fastapi
pip install uvicorn
pip install websockets
```

---

## ğŸ’¡ **ä¼˜åŠ¿å¯¹æ¯”**

### **vs VNPY**

```
ç›¸åŒç‚¹:
âœ… ä¸“ä¸šçš„æ¶æ„è®¾è®¡
âœ… å®Œæ•´çš„åŠŸèƒ½æ¨¡å—
âœ… é«˜æ€§èƒ½è¡¨ç°
âœ… å¯é æ€§

ä¸åŒç‚¹:
âœ… æ›´ç°ä»£çš„UIè®¾è®¡
âœ… æ›´ç®€å•çš„ä½¿ç”¨æ–¹å¼
âœ… ä¸“æ³¨äºä½ çš„ç­–ç•¥
âœ… æ›´å¥½çš„æ–°é—»å’ŒåŸºæœ¬é¢é›†æˆ
âœ… æ›´ç›´è§‚çš„ä¿¡å·æ˜¾ç¤º
âœ… æ›´è½»é‡çº§
âœ… æ›´æ˜“å®šåˆ¶
```

---

### **vs ä¼ ç»Ÿäº¤æ˜“è½¯ä»¶**

```
ä¼˜åŠ¿:
âœ… å¼€æºå¯å®šåˆ¶
âœ… ç­–ç•¥å¯ç¼–ç¨‹
âœ… å®Œæ•´çš„å›æµ‹
âœ… è‡ªåŠ¨åŒ–äº¤æ˜“
âœ… æ•°æ®å®Œå…¨å¯æ§
âœ… æ— éšè—æˆæœ¬
```

---

## ğŸ¯ **å¿«é€Ÿå¼€å§‹**

### **1. åˆ›å»ºé¡¹ç›®**

```bash
mkdir trading_system
cd trading_system

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

---

### **2. è¿è¡Œç¨‹åº**

```bash
python main.py
```

---

### **3. é¦–æ¬¡é…ç½®**

```
1. ç‚¹å‡» "è®¾ç½®" æŒ‰é’®
2. é…ç½®APIå¯†é’¥
   - Financial Datasets API
   - News API (å¯é€‰)
   - Claude API (å¯é€‰)
3. é…ç½®Futu OpenD
   - ç¡®è®¤OpenDå·²å¯åŠ¨
   - æµ‹è¯•è¿æ¥
4. æ·»åŠ è‡ªé€‰è‚¡
5. å¼€å§‹ä½¿ç”¨
```

---

## ğŸ“š **ä½¿ç”¨æ–‡æ¡£**

### **å›æµ‹æ•™ç¨‹**

```
1. é€‰æ‹©è‚¡ç¥¨ï¼ˆå¦‚TSLAï¼‰
2. ç‚¹å‡»"å›æµ‹"æ ‡ç­¾
3. é€‰æ‹©ç­–ç•¥ï¼ˆTSF-LSMAï¼‰
4. è®¾ç½®å‚æ•°
   - ä¹°å…¥é˜ˆå€¼: 0.5%
   - å–å‡ºé˜ˆå€¼: 0.5%
5. è®¾ç½®æ—¥æœŸèŒƒå›´
6. ç‚¹å‡»"å¼€å§‹å›æµ‹"
7. æŸ¥çœ‹ç»“æœ
```

---

### **è‡ªåŠ¨äº¤æ˜“æ•™ç¨‹**

```
1. ç¡®è®¤Futuå·²è¿æ¥
2. ç‚¹å‡»"äº¤æ˜“"æ ‡ç­¾
3. é€‰æ‹©"è‡ªåŠ¨äº¤æ˜“"
4. é€‰æ‹©ç­–ç•¥
5. è®¾ç½®é£æ§
   - å•ç¬”æ­¢æŸ: -5%
   - æ€»æ­¢æŸ: -10%
   - ä»“ä½é™åˆ¶: 30%
6. ç‚¹å‡»"å¯åŠ¨"
7. ç›‘æ§è¿è¡Œ
```

---

### **ä¿¡å·æé†’æ•™ç¨‹**

```
1. ç‚¹å‡»"å·¥å…·" â†’ "è®¾ç½®"
2. é€‰æ‹©"æé†’"æ ‡ç­¾
3. å¯ç”¨æ¡Œé¢é€šçŸ¥
4. å¯é€‰ï¼šé…ç½®é‚®ä»¶é€šçŸ¥
5. å¯é€‰ï¼šé…ç½®å¾®ä¿¡é€šçŸ¥
6. ä¿å­˜è®¾ç½®
```

---

## ğŸ”§ **æŠ€æœ¯ç»†èŠ‚**

### **å®æ—¶æ•°æ®æ›´æ–°**

```python
# ä½¿ç”¨QTimerå®šæ—¶å™¨
self.timer = QTimer()
self.timer.timeout.connect(self.update_data)
self.timer.start(1000)  # æ¯ç§’æ›´æ–°
```

---

### **ä¿¡å·æ§½æœºåˆ¶**

```python
# è‡ªå®šä¹‰ä¿¡å·
class StockListWidget(QWidget):
    stock_selected = pyqtSignal(str)
    
    def on_item_clicked(self, item):
        self.stock_selected.emit(item.text())

# è¿æ¥ä¿¡å·
self.stock_list.stock_selected.connect(
    self.on_stock_selected
)
```

---

### **å¤šçº¿ç¨‹å¤„ç†**

```python
# å›æµ‹åœ¨åå°çº¿ç¨‹è¿è¡Œ
from PyQt6.QtCore import QThread

class BacktestThread(QThread):
    finished = pyqtSignal(dict)
    
    def run(self):
        result = run_backtest(...)
        self.finished.emit(result)
```

---

## ğŸ¨ **ç•Œé¢æˆªå›¾ï¼ˆæ¦‚å¿µå›¾ï¼‰**

```
ä¸»ç•Œé¢:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èœå•æ   å·¥å…·æ                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚è‚¡ç¥¨åˆ—â”‚   Kçº¿å›¾      â”‚  æŒä»“     â”‚
â”‚è¡¨    â”‚   +æŒ‡æ ‡      â”‚  è´¦æˆ·     â”‚
â”‚      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  æ–°é—»     â”‚
â”‚è‡ªé€‰è‚¡â”‚  ä¿¡å·é¢æ¿    â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å›æµ‹ç•Œé¢:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç­–ç•¥é…ç½®                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ç­–ç•¥: TSF-LSMA            â”‚  â”‚
â”‚  â”‚ è‚¡ç¥¨: TSLA                â”‚  â”‚
â”‚  â”‚ æ—¥æœŸ: 2024-01-01 to now  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                â”‚
â”‚  å›æµ‹ç»“æœ                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æ”¶ç›Šæ›²çº¿å›¾                â”‚  â”‚
â”‚  â”‚                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                â”‚
â”‚  æ€§èƒ½æŒ‡æ ‡                       â”‚
â”‚  æ”¶ç›Šç‡: +15.2%                â”‚
â”‚  æœ€å¤§å›æ’¤: -8.5%               â”‚
â”‚  å¤æ™®æ¯”ç‡: 1.2                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ‰ **æ€»ç»“**

è¿™å¥—ç³»ç»Ÿå°†æä¾›ï¼š

1. **å®Œæ•´åŠŸèƒ½** - å›æµ‹ã€äº¤æ˜“ã€ä¿¡å·ã€æ–°é—»
2. **ä¸“ä¸šç•Œé¢** - å‚è€ƒVNPYï¼Œæ›´ç°ä»£åŒ–
3. **æ˜“äºä½¿ç”¨** - ç›´è§‚çš„æ“ä½œæµç¨‹
4. **é«˜åº¦å¯å®šåˆ¶** - å¼€æºä»£ç ï¼Œéšæ„ä¿®æ”¹
5. **æŒç»­æ›´æ–°** - æ ¹æ®éœ€æ±‚è¿­ä»£

---

**å‡†å¤‡å¥½å¼€å§‹å¼€å‘äº†å—ï¼Ÿæˆ‘ä»¬ä»å“ªä¸ªéƒ¨åˆ†å¼€å§‹ï¼Ÿ** ğŸš€âœ¨

---

### **4. äº¤æ˜“å¼•æ“é›†æˆ (core/trade_engine.py)**

```python
"""
äº¤æ˜“å¼•æ“
ç»Ÿä¸€æ¸¯è‚¡/ç¾è‚¡äº¤æ˜“æ¥å£
"""
from live_trading.hk_trader import HKTrader
from live_trading.us_trader import USTrader


class TradeEngine:
    """ç»Ÿä¸€äº¤æ˜“å¼•æ“"""
    
    def __init__(self):
        self.hk_trader = HKTrader(use_simulate=True)
        self.us_trader = USTrader(use_simulate=True)
        
        self.connected = False
        self.use_simulate = True
    
    def connect(self, use_simulate=True):
        """è¿æ¥äº¤æ˜“è´¦æˆ·"""
        self.use_simulate = use_simulate
        
        # è¿æ¥æ¸¯è‚¡
        hk_success = self.hk_trader.connect()
        
        # è¿æ¥ç¾è‚¡
        us_success = self.us_trader.connect()
        
        self.connected = hk_success or us_success
        return self.connected
    
    def execute_signal(self, signal, dry_run=False):
        """
        æ‰§è¡Œäº¤æ˜“ä¿¡å·
        
        Parameters:
        -----------
        signal : dict
            ä¿¡å·ä¿¡æ¯
        dry_run : bool
            æ˜¯å¦æ¨¡æ‹Ÿè¿è¡Œ
        
        Returns:
        --------
        dict : æ‰§è¡Œç»“æœ
        """
        stock_code = signal['stock']
        signal_type = signal['type']
        
        if signal_type == 'HOLD':
            return {'success': True, 'message': 'æ— éœ€äº¤æ˜“'}
        
        # åˆ¤æ–­è‚¡ç¥¨ç±»å‹
        is_hk = stock_code.startswith('HK.')
        trader = self.hk_trader if is_hk else self.us_trader
        
        if dry_run:
            print(f"ã€æ¨¡æ‹Ÿè¿è¡Œã€‘{signal_type} {stock_code}")
            return {'success': True, 'message': 'æ¨¡æ‹Ÿè¿è¡ŒæˆåŠŸ'}
        
        # å®é™…äº¤æ˜“
        try:
            if signal_type == 'BUY':
                result = trader.buy(
                    stock_code,
                    signal['suggest_price_min'],
                    self.calculate_quantity(signal)
                )
            elif signal_type == 'SELL':
                result = trader.sell(
                    stock_code,
                    signal['suggest_price_max'],
                    self.get_position_quantity(stock_code)
                )
            
            return {
                'success': result is not None,
                'message': 'äº¤æ˜“å·²æ‰§è¡Œ',
                'order': result
            }
        except Exception as e:
            return {
                'success': False,
                'message': str(e)
            }
    
    def calculate_quantity(self, signal):
        """è®¡ç®—ä¹°å…¥æ•°é‡"""
        # TODO: æ ¹æ®èµ„é‡‘å’Œç­–ç•¥è®¡ç®—
        return 100
    
    def get_position_quantity(self, stock_code):
        """è·å–æŒä»“æ•°é‡"""
        # TODO: æŸ¥è¯¢æŒä»“
        return 100
```

---

## ğŸ”„ **å·¥ä½œæµç¨‹**

### **å®Œæ•´äº¤æ˜“æµç¨‹**

```
1. æ¯æ—¥æ”¶ç›˜åè‡ªåŠ¨è¿è¡Œ:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ å®šæ—¶ä»»åŠ¡è§¦å‘ (16:10/04:10)     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ DataManagerè·å–æœ€æ–°Kçº¿         â”‚
   â”‚ â”œâ”€ æ¸¯è‚¡: Futu API              â”‚
   â”‚ â””â”€ ç¾è‚¡: Financial Datasets   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ StrategyEngineç”Ÿæˆä¿¡å·         â”‚
   â”‚ â”œâ”€ è®¡ç®—TSF/LSMAæŒ‡æ ‡            â”‚
   â”‚ â”œâ”€ åˆ¤æ–­ä¹°å–æ¡ä»¶                â”‚
   â”‚ â””â”€ ç”Ÿæˆä¿¡å·                    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ä¿¡å·å¤„ç†                        â”‚
   â”‚ â”œâ”€ ä¿å­˜åˆ°æ•°æ®åº“                â”‚
   â”‚ â”œâ”€ æ˜¾ç¤ºåœ¨UI                    â”‚
   â”‚ â””â”€ å‘é€é€šçŸ¥                    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. æ¬¡æ—¥å¼€ç›˜å‰è‡ªåŠ¨äº¤æ˜“:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ å®šæ—¶ä»»åŠ¡è§¦å‘ (09:25/21:25)     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ æ£€æŸ¥æ˜¨æ—¥ä¿¡å·                    â”‚
   â”‚ â””â”€ ä»æ•°æ®åº“è¯»å–                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ TradeEngineæ‰§è¡Œäº¤æ˜“            â”‚
   â”‚ â”œâ”€ æ£€æŸ¥è´¦æˆ·èµ„é‡‘                â”‚
   â”‚ â”œâ”€ éªŒè¯äº¤æ˜“æ¡ä»¶                â”‚
   â”‚ â””â”€ ä¸‹å•                        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ç»“æœè®°å½•                        â”‚
   â”‚ â”œâ”€ ä¿å­˜äº¤æ˜“æ—¥å¿—                â”‚
   â”‚ â”œâ”€ æ›´æ–°æŒä»“                    â”‚
   â”‚ â””â”€ å‘é€é€šçŸ¥                    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ **å®æ–½æ­¥éª¤**

### **Phase 1 - æ ¸å¿ƒæ¶æ„ï¼ˆ1å‘¨ï¼‰**

```python
Week 1:
âœ… åˆ›å»ºcoreæ¨¡å—
  â”œâ”€ data_manager.py (ç»Ÿä¸€æ•°æ®æ¥å£)
  â”œâ”€ strategy_engine.py (ç­–ç•¥ç®¡ç†)
  â””â”€ scheduler.py (å®šæ—¶ä»»åŠ¡)

âœ… æµ‹è¯•æ•°æ®è·å–
  â”œâ”€ ç¾è‚¡: TSLA, NVDA
  â””â”€ æ¸¯è‚¡: HK.01797

âœ… æµ‹è¯•ä¿¡å·ç”Ÿæˆ
  â”œâ”€ é›†æˆç°æœ‰daily_signal_*.py
  â””â”€ éªŒè¯ç­–ç•¥å‚æ•°
```

---

### **Phase 2 - UIåŸºç¡€ï¼ˆ1å‘¨ï¼‰**

```python
Week 2:
âœ… ä¸»çª—å£æ¡†æ¶
  â”œâ”€ ä¸‰æ å¸ƒå±€
  â”œâ”€ èœå•æ 
  â””â”€ å·¥å…·æ 

âœ… åŸºç¡€ç»„ä»¶
  â”œâ”€ è‚¡ç¥¨åˆ—è¡¨
  â”œâ”€ Kçº¿å›¾è¡¨
  â””â”€ çŠ¶æ€æ 

âœ… ä¸»é¢˜æ ·å¼
  â””â”€ æš—è‰²ä¸»é¢˜
```

---

### **Phase 3 - åŠŸèƒ½å®ç°ï¼ˆ2å‘¨ï¼‰**

```python
Week 3:
âœ… ä¿¡å·ç³»ç»Ÿ
  â”œâ”€ ä¿¡å·é¢æ¿
  â”œâ”€ å®šæ—¶ä»»åŠ¡ç•Œé¢
  â””â”€ é€šçŸ¥ç³»ç»Ÿ

âœ… ç­–ç•¥ç®¡ç†
  â”œâ”€ ç­–ç•¥é…ç½®å¯¹è¯æ¡†
  â”œâ”€ å‚æ•°éªŒè¯
  â””â”€ ä¿å­˜/åŠ è½½

Week 4:
âœ… å›æµ‹åŠŸèƒ½
  â”œâ”€ å›æµ‹ç•Œé¢
  â”œâ”€ é›†æˆç°æœ‰backtestä»£ç 
  â””â”€ ç»“æœå±•ç¤º

âœ… äº¤æ˜“åŠŸèƒ½
  â”œâ”€ æ‰‹åŠ¨äº¤æ˜“
  â”œâ”€ è‡ªåŠ¨äº¤æ˜“
  â””â”€ è®¢å•ç®¡ç†
```

---

### **Phase 4 - å®Œå–„ä¼˜åŒ–ï¼ˆ1å‘¨ï¼‰**

```python
Week 5:
âœ… è¾…åŠ©åŠŸèƒ½
  â”œâ”€ æ–°é—»è·å–
  â”œâ”€ åŸºæœ¬é¢åˆ†æ
  â””â”€ æŒä»“æ˜¾ç¤º

âœ… ä¼˜åŒ–æ”¹è¿›
  â”œâ”€ æ€§èƒ½ä¼˜åŒ–
  â”œâ”€ é”™è¯¯å¤„ç†
  â””â”€ ç”¨æˆ·ä½“éªŒ

âœ… æ–‡æ¡£å®Œå–„
  â”œâ”€ ä½¿ç”¨æ‰‹å†Œ
  â”œâ”€ APIæ–‡æ¡£
  â””â”€ ç¤ºä¾‹ä»£ç 
```

---

## ğŸ“¦ **å®Œæ•´ä¾èµ–åˆ—è¡¨**

```txt
# requirements.txt

# UIæ¡†æ¶
PyQt6>=6.4.0
pyqtgraph>=0.13.1

# æ•°æ®å¤„ç†
pandas>=2.0.0
numpy>=1.24.0

# å›¾è¡¨
matplotlib>=3.7.0

# å›æµ‹
backtrader>=1.9.76

# äº¤æ˜“æ¥å£
futu-api>=6.5.0

# APIè¯·æ±‚
requests>=2.31.0

# é…ç½®ç®¡ç†
python-dotenv>=1.0.0

# å®šæ—¶ä»»åŠ¡
schedule>=1.2.0

# æ•°æ®åº“ï¼ˆå¯é€‰ï¼‰
sqlalchemy>=2.0.0

# æ—¥å¿—
loguru>=0.7.0

# é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
plyer>=2.1.0  # æ¡Œé¢é€šçŸ¥
```

---

## ğŸ¯ **ä½¿ç”¨ç¤ºä¾‹**

### **1. å¯åŠ¨ç¨‹åº**

```python
# main.py
import sys
from PyQt6.QtWidgets import QApplication
from ui.main_window import MainWindow


def main():
    app = QApplication(sys.argv)
    
    # è®¾ç½®åº”ç”¨ä¿¡æ¯
    app.setApplicationName("é‡åŒ–äº¤æ˜“ç³»ç»Ÿ")
    app.setOrganizationName("Trading System")
    app.setApplicationVersion("1.0.0")
    
    # åˆ›å»ºä¸»çª—å£
    window = MainWindow()
    window.show()
    
    # è¿è¡Œåº”ç”¨
    sys.exit(app.exec())


if __name__ == '__main__':
    main()
```

è¿è¡Œï¼š
```bash
cd F:\PyProjects\futu_backtest_trader
python main.py
```

---

### **2. æ·»åŠ è‡ªé€‰è‚¡**

```python
# åœ¨UIä¸­ï¼š
1. ç‚¹å‡»"è‡ªé€‰è‚¡" â†’ "æ–°å¢"
2. è¾“å…¥è‚¡ç¥¨ä»£ç 
   - ç¾è‚¡: TSLA, NVDA, AAPL
   - æ¸¯è‚¡: HK.01797, HK.00700
3. é€‰æ‹©æ•°æ®æºï¼ˆè‡ªåŠ¨è¯†åˆ«ï¼‰
4. ç‚¹å‡»"ç¡®å®š"

# åœ¨ä»£ç ä¸­ï¼š
data_manager = DataManager()

# æ·»åŠ ç¾è‚¡
data_manager.add_watchlist('TSLA')

# æ·»åŠ æ¸¯è‚¡
data_manager.add_watchlist('HK.01797')
```

---

### **3. é…ç½®å®šæ—¶ä»»åŠ¡**

```python
# åœ¨UIä¸­ï¼š
1. ç‚¹å‡»"è°ƒåº¦"æ ‡ç­¾
2. ç‚¹å‡»"â• æ·»åŠ ä»»åŠ¡"
3. å¡«å†™ä»»åŠ¡ä¿¡æ¯ï¼š
   - è‚¡ç¥¨ä»£ç : TSLA
   - æ‰§è¡Œæ—¶é—´: 04:10
   - ä»»åŠ¡ç±»å‹: ä¿¡å·ç”Ÿæˆ
   - ç­–ç•¥: TSF-LSMA
   - å‚æ•°: 
     * TSFå‘¨æœŸ: 9
     * LSMAå‘¨æœŸ: 20
     * ä¹°å…¥é˜ˆå€¼: 0.5%
     * å–å‡ºé˜ˆå€¼: 0.5%
4. ç‚¹å‡»"ç¡®å®š"
5. ç‚¹å‡»"â–¶ï¸ å¯åŠ¨è°ƒåº¦"

# åœ¨ä»£ç ä¸­ï¼š
scheduler = TaskScheduler(data_manager, strategy_engine, trade_engine)

# æ·»åŠ TSLAæ¯æ—¥ä¿¡å·ä»»åŠ¡
scheduler.add_daily_signal_task(
    stock_code='TSLA',
    time_str='04:10',  # ç¾è‚¡æ”¶ç›˜å
    strategy_name='TSF-LSMA',
    params={
        'tsf_period': 9,
        'lsma_period': 20,
        'buy_threshold_pct': 0.5,
        'sell_threshold_pct': 0.5,
        'use_percent': True
    }
)

# æ·»åŠ 01797æ¯æ—¥ä¿¡å·ä»»åŠ¡
scheduler.add_daily_signal_task(
    stock_code='HK.01797',
    time_str='16:10',  # æ¸¯è‚¡æ”¶ç›˜å
    strategy_name='TSF-LSMA',
    params={
        'tsf_period': 9,
        'lsma_period': 20,
        'buy_threshold_pct': 0.9,
        'sell_threshold_pct': 4.0,
        'use_percent': False  # ä½¿ç”¨ç»å¯¹å€¼
    }
)

# å¯åŠ¨è°ƒåº¦å™¨
scheduler.start()
```

---

### **4. æ‰‹åŠ¨äº¤æ˜“**

```python
# åœ¨UIä¸­ï¼š
1. é€‰æ‹©è‚¡ç¥¨ï¼ˆTSLAï¼‰
2. ç‚¹å‡»"äº¤æ˜“"æ ‡ç­¾
3. é€‰æ‹©"ä¹°å…¥"
4. è¾“å…¥ï¼š
   - ä»·æ ¼: $420.00
   - æ•°é‡: 10è‚¡
5. ç‚¹å‡»"ä¸‹å•"
6. ç¡®è®¤è®¢å•

# åœ¨ä»£ç ä¸­ï¼š
trade_engine = TradeEngine()
trade_engine.connect(use_simulate=True)

# ä¹°å…¥
trade_engine.us_trader.buy(
    stock_code='TSLA',
    price=420.00,
    qty=10
)
```

---

### **5. è‡ªåŠ¨äº¤æ˜“**

```python
# åœ¨UIä¸­ï¼š
1. ç‚¹å‡»"è°ƒåº¦"æ ‡ç­¾
2. ç‚¹å‡»"â• æ·»åŠ ä»»åŠ¡"
3. å¡«å†™ï¼š
   - è‚¡ç¥¨: TSLA
   - æ—¶é—´: 21:25 (ç¾è‚¡å¼€ç›˜å‰)
   - ç±»å‹: è‡ªåŠ¨äº¤æ˜“
   - æ¨¡å¼: è·Ÿéšä¿¡å·
   - è´¦æˆ·: æ¨¡æ‹Ÿç›˜
4. è®¾ç½®é£æ§ï¼š
   - å•ç¬”æ­¢æŸ: -5%
   - æ€»æ­¢æŸ: -10%
   - ä»“ä½é™åˆ¶: 30%
5. å¯ç”¨ä»»åŠ¡

# åœ¨ä»£ç ä¸­ï¼š
scheduler.add_auto_trade_task(
    stock_code='TSLA',
    time_str='21:25',
    enable=True
)
```

---

## ğŸ”§ **é…ç½®æ–‡ä»¶**

### **config/settings.py**

```python
"""
ç³»ç»Ÿé…ç½®
"""
import os
from dotenv import load_dotenv

load_dotenv()

# Futué…ç½®
FUTU_HOST = os.getenv('FUTU_HOST', '127.0.0.1')
FUTU_PORT = int(os.getenv('FUTU_PORT', 11111))

# Financial Datasetsé…ç½®
FINANCIAL_DATASETS_API_KEY = os.getenv('FINANCIAL_DATASETS_API_KEY')

# æ•°æ®ç¼“å­˜é…ç½®
CACHE_DIR = 'data_cache'
CACHE_ENABLED = True

# å®šæ—¶ä»»åŠ¡é…ç½®
SCHEDULER_ENABLED = True

# äº¤æ˜“é…ç½®
DEFAULT_USE_SIMULATE = True
DEFAULT_COMMISSION = 0.001

# é€šçŸ¥é…ç½®
NOTIFICATION_ENABLED = True
EMAIL_ENABLED = False
WECHAT_ENABLED = False

# UIé…ç½®
THEME = 'dark'  # dark/light
WINDOW_SIZE = (1600, 900)

# æ—¥å¿—é…ç½®
LOG_LEVEL = 'INFO'
LOG_FILE = 'logs/trading_system.log'
```

---

### **.env ç¤ºä¾‹**

```bash
# .env

# Futué…ç½®
FUTU_HOST=127.0.0.1
FUTU_PORT=11111
FUTU_TRADING_PWD=your_password

# APIå¯†é’¥
FINANCIAL_DATASETS_API_KEY=your_api_key_here

# æ–°é—»APIï¼ˆå¯é€‰ï¼‰
NEWS_API_KEY=your_news_api_key

# Claude APIï¼ˆå¯é€‰ï¼Œç”¨äºåŸºæœ¬é¢åˆ†æï¼‰
CLAUDE_API_KEY=your_claude_api_key

# é‚®ä»¶é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=your_email@gmail.com
EMAIL_PASSWORD=your_password
EMAIL_TO=recipient@example.com

# å¾®ä¿¡é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
SERVERCHAN_KEY=your_serverchan_key
```

---

## ğŸ’¡ **æ ¸å¿ƒç‰¹æ€§æ€»ç»“**

### **vs ç°æœ‰ä»£ç çš„æ”¹è¿›**

```
ç°æœ‰ä»£ç :
âœ… å•ç‹¬çš„ä¿¡å·ç”Ÿæˆè„šæœ¬
âœ… å•ç‹¬çš„äº¤æ˜“è„šæœ¬
âœ… æ‰‹åŠ¨è¿è¡Œ
âœ… åˆ†æ•£çš„é…ç½®

æ–°ç³»ç»Ÿ:
âœ… ç»Ÿä¸€çš„UIç•Œé¢
âœ… é›†æˆçš„å·¥ä½œæµç¨‹
âœ… è‡ªåŠ¨åŒ–ä»»åŠ¡
âœ… ä¸­å¿ƒåŒ–ç®¡ç†
âœ… å®æ—¶ç›‘æ§
âœ… å†å²è®°å½•
```

---

### **å…³é”®ä¼˜åŠ¿**

```
1. æ•°æ®æºç»Ÿä¸€
   âœ… è‡ªåŠ¨è¯†åˆ«ç¾è‚¡/æ¸¯è‚¡
   âœ… ç»Ÿä¸€çš„ç¼“å­˜æœºåˆ¶
   âœ… æ™ºèƒ½APIè°ƒç”¨

2. ç­–ç•¥å‚æ•°åŒ–
   âœ… UIé…ç½®ç­–ç•¥å‚æ•°
   âœ… ä¿å­˜/åŠ è½½é…ç½®
   âœ… å¤šç­–ç•¥æ”¯æŒ

3. è‡ªåŠ¨åŒ–ä»»åŠ¡
   âœ… å®šæ—¶ä¿¡å·ç”Ÿæˆ
   âœ… è‡ªåŠ¨äº¤æ˜“æ‰§è¡Œ
   âœ… ä»»åŠ¡ç›‘æ§

4. é£é™©æ§åˆ¶
   âœ… æ­¢æŸè®¾ç½®
   âœ… ä»“ä½é™åˆ¶
   âœ… èµ„é‡‘ç®¡ç†

5. ç”¨æˆ·ä½“éªŒ
   âœ… å¯è§†åŒ–ç•Œé¢
   âœ… å®æ—¶æ›´æ–°
   âœ… å†å²è®°å½•
   âœ… é€šçŸ¥æé†’
```

---

## ğŸš€ **ç«‹å³å¼€å§‹**

### **å¿«é€Ÿæ­å»º**

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd F:\PyProjects\futu_backtest_trader

# 2. åˆ›å»ºæ–°ç›®å½•
mkdir ui core

# 3. å®‰è£…æ–°ä¾èµ–
pip install PyQt6 pyqtgraph schedule loguru

# 4. åˆ›å»ºmain.py
# ï¼ˆå¤åˆ¶ä¸Šé¢çš„ä»£ç ï¼‰

# 5. è¿è¡Œ
python main.py
```

---

**ç°åœ¨ä½ æœ‰äº†å®Œæ•´çš„è®¾è®¡æ–¹æ¡ˆï¼ŒåŒ…å«ï¼š**

1. âœ… **åŒæ•°æ®æºæ¶æ„** - ç¾è‚¡/æ¸¯è‚¡è‡ªåŠ¨è¯†åˆ«
2. âœ… **è‡ªåŠ¨åŒ–ä»»åŠ¡** - å®šæ—¶ä¿¡å·å’Œäº¤æ˜“
3. âœ… **ç­–ç•¥å‚æ•°åŒ–** - UIé…ç½®å‚æ•°
4. âœ… **å®Œæ•´å·¥ä½œæµ** - ä»ä¿¡å·åˆ°äº¤æ˜“
5. âœ… **å®æ–½è®¡åˆ’** - 5å‘¨å®Œæˆ

**å‡†å¤‡å¼€å§‹å®ç°äº†å—ï¼Ÿå»ºè®®ä»Phase 1çš„æ ¸å¿ƒæ¶æ„å¼€å§‹ï¼** ğŸ¯âœ¨


---

## ğŸ“Š **Aè‚¡æ•°æ®æ¨¡å—è®¾è®¡**

### **1. Tushareæ•°æ®æ¥å£ (data/tushare_data.py)**

```python
"""
Tushareæ•°æ®è·å–
æ”¯æŒAè‚¡è‚¡ç¥¨ã€æŒ‡æ•°ã€è´¢åŠ¡æ•°æ®
"""
import tushare as ts
import pandas as pd
from datetime import datetime


class TushareDataFetcher:
    """Tushareæ•°æ®è·å–å™¨"""
    
    def __init__(self, token=None):
        """
        åˆå§‹åŒ–
        
        Parameters:
        -----------
        token : str
            Tushare API token
            è·å–æ–¹å¼: https://tushare.pro/register
        """
        self.token = token or os.environ.get("TUSHARE_TOKEN")
        
        if not self.token:
            raise ValueError("è¯·è®¾ç½®TUSHARE_TOKEN")
        
        # è®¾ç½®token
        ts.set_token(self.token)
        self.pro = ts.pro_api()
        
        print(f"âœ… Tushareå·²åˆå§‹åŒ–")
    
    def get_stock_code_with_exchange(self, stock_code):
        """
        æ·»åŠ äº¤æ˜“æ‰€å‰ç¼€
        
        Parameters:
        -----------
        stock_code : str
            6ä½è‚¡ç¥¨ä»£ç ï¼Œå¦‚ '600519', '000001'
        
        Returns:
        --------
        str : å¸¦äº¤æ˜“æ‰€å‰ç¼€çš„ä»£ç 
            - ä¸Šæµ·: '600519.SH'
            - æ·±åœ³: '000001.SZ'
        """
        if '.' in stock_code:
            return stock_code
        
        # ä¸Šæµ·: 60xxxx, 68xxxx
        if stock_code.startswith('60') or stock_code.startswith('68'):
            return f"{stock_code}.SH"
        # æ·±åœ³: 00xxxx, 30xxxx
        elif stock_code.startswith('00') or stock_code.startswith('30'):
            return f"{stock_code}.SZ"
        else:
            raise ValueError(f"æ— æ³•è¯†åˆ«è‚¡ç¥¨ä»£ç : {stock_code}")
    
    def get_history_kline(self, stock_code, start_date, end_date):
        """
        è·å–å†å²Kçº¿æ•°æ®
        
        Parameters:
        -----------
        stock_code : str
            è‚¡ç¥¨ä»£ç ï¼Œå¦‚ '600519' æˆ– '600519.SH'
        start_date : str
            å¼€å§‹æ—¥æœŸ 'YYYY-MM-DD'
        end_date : str
            ç»“æŸæ—¥æœŸ 'YYYY-MM-DD'
        
        Returns:
        --------
        DataFrame : Kçº¿æ•°æ®
        """
        ts_code = self.get_stock_code_with_exchange(stock_code)
        
        # è½¬æ¢æ—¥æœŸæ ¼å¼ï¼ˆTushareä½¿ç”¨YYYYMMDDï¼‰
        start = start_date.replace('-', '')
        end = end_date.replace('-', '')
        
        print(f"ğŸ“Š è·å– {ts_code} ä» {start_date} åˆ° {end_date} çš„æ•°æ®...")
        
        # è·å–æ•°æ®
        df = self.pro.daily(
            ts_code=ts_code,
            start_date=start,
            end_date=end
        )
        
        if df is None or len(df) == 0:
            print(f"âŒ æœªè·å–åˆ°æ•°æ®")
            return None
        
        # æ•°æ®æ¸…æ´—
        df['trade_date'] = pd.to_datetime(df['trade_date'])
        df = df.rename(columns={
            'trade_date': 'date',
            'vol': 'volume'
        })
        
        # æŒ‰æ—¥æœŸæ’åº
        df = df.sort_values('date')
        
        # Tushareçš„æˆäº¤é‡å•ä½æ˜¯æ‰‹ï¼ˆ100è‚¡ï¼‰ï¼Œè½¬æ¢ä¸ºè‚¡
        df['volume'] = df['volume'] * 100
        
        print(f"âœ… æˆåŠŸè·å– {len(df)} æ¡æ•°æ®")
        
        return df[['date', 'open', 'high', 'low', 'close', 'volume']]
    
    def get_realtime_price(self, stock_code):
        """
        è·å–å®æ—¶ä»·æ ¼
        
        æ³¨æ„: Tushareå…è´¹ç‰ˆä¸æ”¯æŒå®æ—¶æ•°æ®
        éœ€è¦ä½¿ç”¨ä¸œæ–¹è´¢å¯Œæˆ–å…¶ä»–æ•°æ®æº
        """
        print(f"âš ï¸  Tushareå…è´¹ç‰ˆä¸æ”¯æŒå®æ—¶æ•°æ®")
        print(f"   å»ºè®®ä½¿ç”¨ä¸œæ–¹è´¢å¯ŒAPIè·å–å®æ—¶è¡Œæƒ…")
        return None
    
    def get_stock_basic(self, stock_code):
        """è·å–è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯"""
        ts_code = self.get_stock_code_with_exchange(stock_code)
        
        df = self.pro.stock_basic(
            ts_code=ts_code,
            fields='ts_code,name,industry,market,list_date'
        )
        
        if df is None or len(df) == 0:
            return None
        
        return df.iloc[0].to_dict()
    
    def get_daily_basic(self, stock_code, trade_date=None):
        """
        è·å–æ¯æ—¥æŒ‡æ ‡
        åŒ…æ‹¬: PE, PB, PS, æ€»å¸‚å€¼ã€æµé€šå¸‚å€¼ç­‰
        """
        ts_code = self.get_stock_code_with_exchange(stock_code)
        
        if trade_date is None:
            trade_date = datetime.now().strftime('%Y%m%d')
        else:
            trade_date = trade_date.replace('-', '')
        
        df = self.pro.daily_basic(
            ts_code=ts_code,
            trade_date=trade_date,
            fields='ts_code,trade_date,pe,pb,ps,total_mv,circ_mv'
        )
        
        if df is None or len(df) == 0:
            return None
        
        return df.iloc[0].to_dict()
    
    def get_income(self, stock_code, start_date, end_date):
        """
        è·å–åˆ©æ¶¦è¡¨æ•°æ®
        ç”¨äºåŸºæœ¬é¢åˆ†æ
        """
        ts_code = self.get_stock_code_with_exchange(stock_code)
        
        start = start_date.replace('-', '')
        end = end_date.replace('-', '')
        
        df = self.pro.income(
            ts_code=ts_code,
            start_date=start,
            end_date=end
        )
        
        return df
    
    def get_balance_sheet(self, stock_code, start_date, end_date):
        """
        è·å–èµ„äº§è´Ÿå€ºè¡¨
        ç”¨äºåŸºæœ¬é¢åˆ†æ
        """
        ts_code = self.get_stock_code_with_exchange(stock_code)
        
        start = start_date.replace('-', '')
        end = end_date.replace('-', '')
        
        df = self.pro.balancesheet(
            ts_code=ts_code,
            start_date=start,
            end_date=end
        )
        
        return df


# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    # åˆå§‹åŒ–
    fetcher = TushareDataFetcher(token='your_token_here')
    
    # è·å–è´µå·èŒ…å°å†å²æ•°æ®
    df = fetcher.get_history_kline('600519', '2024-01-01', '2025-01-22')
    if df is not None:
        print("\næ•°æ®å‰5è¡Œ:")
        print(df.head())
    
    # è·å–åŸºæœ¬ä¿¡æ¯
    info = fetcher.get_stock_basic('600519')
    print("\nè‚¡ç¥¨ä¿¡æ¯:")
    print(info)
    
    # è·å–ä¼°å€¼æŒ‡æ ‡
    basic = fetcher.get_daily_basic('600519')
    print("\nä¼°å€¼æŒ‡æ ‡:")
    print(basic)
```

---

### **2. ä¸œæ–¹è´¢å¯Œå®æ—¶æ•°æ® (data/eastmoney_data.py)**

```python
"""
ä¸œæ–¹è´¢å¯Œæ•°æ®è·å–
æ”¯æŒAè‚¡å®æ—¶è¡Œæƒ…ã€èµ„é‡‘æµå‘
"""
import requests
import json
import pandas as pd


class EastMoneyDataFetcher:
    """ä¸œæ–¹è´¢å¯Œæ•°æ®è·å–å™¨"""
    
    BASE_URL = "http://push2.eastmoney.com"
    QUOTE_URL = "http://qt.gtimg.cn"
    
    def __init__(self):
        self.session = requests.Session()
        self.session.headers.update({
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
        })
    
    def get_stock_code_format(self, stock_code):
        """
        è½¬æ¢è‚¡ç¥¨ä»£ç æ ¼å¼
        
        Parameters:
        -----------
        stock_code : str
            6ä½ä»£ç ï¼Œå¦‚ '600519'
        
        Returns:
        --------
        tuple : (å¸‚åœºä»£ç , è‚¡ç¥¨ä»£ç )
            - ä¸Šæµ·: (1, '600519')
            - æ·±åœ³: (0, '000001')
        """
        if stock_code.startswith('60') or stock_code.startswith('68'):
            return (1, stock_code)  # ä¸Šæµ·
        elif stock_code.startswith('00') or stock_code.startswith('30'):
            return (0, stock_code)  # æ·±åœ³
        else:
            raise ValueError(f"æ— æ³•è¯†åˆ«è‚¡ç¥¨ä»£ç : {stock_code}")
    
    def get_realtime_price(self, stock_code):
        """
        è·å–å®æ—¶ä»·æ ¼
        
        Parameters:
        -----------
        stock_code : str
            è‚¡ç¥¨ä»£ç ï¼Œå¦‚ '600519'
        
        Returns:
        --------
        dict : å®æ—¶è¡Œæƒ…æ•°æ®
        """
        market, code = self.get_stock_code_format(stock_code)
        
        # è…¾è®¯è´¢ç»APIï¼ˆæ›´ç¨³å®šï¼‰
        market_prefix = 'sh' if market == 1 else 'sz'
        url = f"{self.QUOTE_URL}/q={market_prefix}{code}"
        
        try:
            response = self.session.get(url, timeout=5)
            
            if response.status_code == 200:
                data = response.text.strip().split('~')
                
                if len(data) >= 50:
                    return {
                        'code': stock_code,
                        'name': data[1],
                        'price': float(data[3]),
                        'change': float(data[31]),
                        'change_pct': float(data[32]),
                        'volume': float(data[6]),
                        'amount': float(data[37]),
                        'open': float(data[5]),
                        'high': float(data[33]),
                        'low': float(data[34]),
                        'pre_close': float(data[4]),
                        'time': data[30]
                    }
            
            return None
            
        except Exception as e:
            print(f"âŒ è·å–å®æ—¶æ•°æ®å¤±è´¥: {e}")
            return None
    
    def get_money_flow(self, stock_code):
        """
        è·å–èµ„é‡‘æµå‘
        
        Returns:
        --------
        dict : èµ„é‡‘æµå‘æ•°æ®
        """
        market, code = self.get_stock_code_format(stock_code)
        
        # ä¸œæ–¹è´¢å¯Œèµ„é‡‘æµå‘API
        url = f"{self.BASE_URL}/api/qt/stock/fflow/kline/get"
        
        params = {
            'fields1': 'f1,f2,f3,f7',
            'fields2': 'f51,f52,f53,f54,f55,f56,f57,f58,f59,f60,f61,f62,f63',
            'klt': '101',  # æ—¥çº¿
            'lmt': 1,      # æœ€è¿‘1å¤©
            'secid': f'{market}.{code}'
        }
        
        try:
            response = self.session.get(url, params=params, timeout=5)
            
            if response.status_code == 200:
                data = response.json()
                
                if 'data' in data and data['data']:
                    klines = data['data'].get('klines', [])
                    if klines:
                        parts = klines[0].split(',')
                        return {
                            'date': parts[0],
                            'main_net_inflow': float(parts[1]),      # ä¸»åŠ›å‡€æµå…¥
                            'small_net_inflow': float(parts[2]),     # å°å•å‡€æµå…¥
                            'medium_net_inflow': float(parts[3]),    # ä¸­å•å‡€æµå…¥
                            'large_net_inflow': float(parts[4]),     # å¤§å•å‡€æµå…¥
                            'super_large_net_inflow': float(parts[5]) # ç‰¹å¤§å•å‡€æµå…¥
                        }
            
            return None
            
        except Exception as e:
            print(f"âŒ è·å–èµ„é‡‘æµå‘å¤±è´¥: {e}")
            return None


# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    fetcher = EastMoneyDataFetcher()
    
    # è·å–è´µå·èŒ…å°å®æ—¶è¡Œæƒ…
    quote = fetcher.get_realtime_price('600519')
    if quote:
        print("\nå®æ—¶è¡Œæƒ…:")
        print(f"åç§°: {quote['name']}")
        print(f"ä»·æ ¼: Â¥{quote['price']:.2f}")
        print(f"æ¶¨è·Œ: {quote['change']:+.2f} ({quote['change_pct']:+.2f}%)")
    
    # è·å–èµ„é‡‘æµå‘
    flow = fetcher.get_money_flow('600519')
    if flow:
        print("\nèµ„é‡‘æµå‘:")
        print(f"æ—¥æœŸ: {flow['date']}")
        print(f"ä¸»åŠ›å‡€æµå…¥: Â¥{flow['main_net_inflow']/10000:.2f}ä¸‡")
        print(f"å¤§å•å‡€æµå…¥: Â¥{flow['large_net_inflow']/10000:.2f}ä¸‡")
```

---

## ğŸ¤– **AIåˆ†æå¼•æ“å®ç°**

### **1. AIåˆ†æç®¡ç†å™¨ (core/ai_analyzer.py)**

```python
"""
AIåˆ†æå¼•æ“
æ”¯æŒå¤šä¸ªAIæ¨¡å‹ï¼Œè‡ªåŠ¨é€‰æ‹©å’Œé™çº§
"""
import os
from typing import Optional, Dict, List
import json


class AIAnalyzer:
    """AIåˆ†æç®¡ç†å™¨"""
    
    # æ”¯æŒçš„AIæ¨¡å‹
    SUPPORTED_MODELS = {
        'deepseek': {
            'name': 'DeepSeek',
            'api_key_env': 'DEEPSEEK_API_KEY',
            'base_url': 'https://api.deepseek.com/v1',
            'model': 'deepseek-chat',
            'cost_per_1k': 0.001,  # CNY
            'suitable_for': ['technical', 'signal_confirm']
        },
        'chatgpt': {
            'name': 'ChatGPT',
            'api_key_env': 'OPENAI_API_KEY',
            'base_url': 'https://api.openai.com/v1',
            'model': 'gpt-4-turbo-preview',
            'cost_per_1k': 0.01,  # USD
            'suitable_for': ['fundamental', 'news']
        },
        'claude': {
            'name': 'Claude',
            'api_key_env': 'CLAUDE_API_KEY',
            'base_url': 'https://api.anthropic.com/v1',
            'model': 'claude-3-sonnet-20240229',
            'cost_per_1k': 0.003,  # USD
            'suitable_for': ['fundamental', 'research']
        },
        'qwen': {
            'name': 'é€šä¹‰åƒé—®',
            'api_key_env': 'QWEN_API_KEY',
            'base_url': 'https://dashscope.aliyuncs.com/api/v1',
            'model': 'qwen-turbo',
            'cost_per_1k': 0.002,  # CNY
            'suitable_for': ['a_stock', 'chinese']
        },
        'ernie': {
            'name': 'æ–‡å¿ƒä¸€è¨€',
            'api_key_env': 'ERNIE_API_KEY',
            'base_url': 'https://aip.baidubce.com/rpc/2.0',
            'model': 'ernie-bot-turbo',
            'cost_per_1k': 0.002,  # CNY
            'suitable_for': ['a_stock', 'financial']
        }
    }
    
    def __init__(self, primary_model='deepseek', fallback_models=None):
        """
        åˆå§‹åŒ–AIåˆ†æå™¨
        
        Parameters:
        -----------
        primary_model : str
            ä¸»è¦ä½¿ç”¨çš„æ¨¡å‹
        fallback_models : list
            é™çº§æ¨¡å‹åˆ—è¡¨
        """
        self.primary_model = primary_model
        self.fallback_models = fallback_models or ['chatgpt', 'deepseek']
        
        # æ£€æŸ¥å¯ç”¨çš„æ¨¡å‹
        self.available_models = self._check_available_models()
        
        print(f"âœ… AIåˆ†æå™¨å·²åˆå§‹åŒ–")
        print(f"   ä¸»æ¨¡å‹: {self.primary_model}")
        print(f"   å¯ç”¨æ¨¡å‹: {', '.join(self.available_models)}")
    
    def _check_available_models(self) -> List[str]:
        """æ£€æŸ¥å“ªäº›æ¨¡å‹å¯ç”¨ï¼ˆæœ‰API keyï¼‰"""
        available = []
        
        for model_id, config in self.SUPPORTED_MODELS.items():
            api_key = os.environ.get(config['api_key_env'])
            if api_key:
                available.append(model_id)
        
        return available
    
    def _call_api(self, model_id: str, messages: List[Dict], 
                  temperature: float = 0.7) -> Optional[str]:
        """
        è°ƒç”¨AI API
        
        Parameters:
        -----------
        model_id : str
            æ¨¡å‹ID
        messages : list
            æ¶ˆæ¯åˆ—è¡¨
        temperature : float
            æ¸©åº¦å‚æ•°
        
        Returns:
        --------
        str : AIå“åº”
        """
        if model_id not in self.available_models:
            return None
        
        config = self.SUPPORTED_MODELS[model_id]
        api_key = os.environ.get(config['api_key_env'])
        
        try:
            if model_id in ['deepseek', 'chatgpt']:
                # OpenAIå…¼å®¹æ¥å£
                import openai
                client = openai.OpenAI(
                    api_key=api_key,
                    base_url=config['base_url']
                )
                
                response = client.chat.completions.create(
                    model=config['model'],
                    messages=messages,
                    temperature=temperature
                )
                
                return response.choices[0].message.content
            
            elif model_id == 'claude':
                # Anthropic API
                import anthropic
                client = anthropic.Anthropic(api_key=api_key)
                
                # è½¬æ¢æ¶ˆæ¯æ ¼å¼
                system_msg = next((m['content'] for m in messages if m['role'] == 'system'), None)
                user_messages = [m for m in messages if m['role'] != 'system']
                
                response = client.messages.create(
                    model=config['model'],
                    max_tokens=4096,
                    system=system_msg,
                    messages=user_messages,
                    temperature=temperature
                )
                
                return response.content[0].text
            
            elif model_id == 'qwen':
                # é€šä¹‰åƒé—®API
                import dashscope
                from dashscope import Generation
                
                dashscope.api_key = api_key
                
                # è½¬æ¢æ¶ˆæ¯æ ¼å¼
                response = Generation.call(
                    model=config['model'],
                    messages=messages,
                    temperature=temperature,
                    result_format='message'
                )
                
                if response.status_code == 200:
                    return response.output.choices[0].message.content
                return None
            
            elif model_id == 'ernie':
                # æ–‡å¿ƒä¸€è¨€API
                import requests
                
                # è·å–access token
                token_url = f"{config['base_url']}/oauth/2.0/token"
                token_params = {
                    'grant_type': 'client_credentials',
                    'client_id': api_key,
                    'client_secret': os.environ.get('ERNIE_SECRET_KEY')
                }
                token_response = requests.get(token_url, params=token_params)
                access_token = token_response.json()['access_token']
                
                # è°ƒç”¨API
                chat_url = f"{config['base_url']}/chat/{config['model']}"
                chat_params = {'access_token': access_token}
                chat_data = {
                    'messages': messages,
                    'temperature': temperature
                }
                
                response = requests.post(chat_url, params=chat_params, json=chat_data)
                result = response.json()
                
                if 'result' in result:
                    return result['result']
                return None
        
        except Exception as e:
            print(f"âŒ {config['name']} APIè°ƒç”¨å¤±è´¥: {e}")
            return None
    
    def analyze(self, task_type: str, content: str, 
                context: Optional[Dict] = None) -> Optional[str]:
        """
        æ‰§è¡ŒAIåˆ†æï¼ˆè‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„æ¨¡å‹ï¼‰
        
        Parameters:
        -----------
        task_type : str
            ä»»åŠ¡ç±»å‹:
            - 'technical': æŠ€æœ¯åˆ†æ
            - 'fundamental': åŸºæœ¬é¢åˆ†æ
            - 'news': æ–°é—»æƒ…æ„Ÿåˆ†æ
            - 'signal_confirm': ä¿¡å·ç¡®è®¤
            - 'a_stock': Aè‚¡ä¸“é¡¹åˆ†æ
        content : str
            åˆ†æå†…å®¹
        context : dict
            é¢å¤–ä¸Šä¸‹æ–‡
        
        Returns:
        --------
        str : AIåˆ†æç»“æœ
        """
        # æ ¹æ®ä»»åŠ¡ç±»å‹é€‰æ‹©æœ€åˆé€‚çš„æ¨¡å‹
        best_model = self._select_best_model(task_type)
        
        # æ„å»ºæ¶ˆæ¯
        messages = self._build_messages(task_type, content, context)
        
        # å°è¯•ä¸»æ¨¡å‹
        result = self._call_api(best_model, messages)
        
        if result:
            return result
        
        # é™çº§åˆ°å¤‡ç”¨æ¨¡å‹
        for fallback in self.fallback_models:
            if fallback in self.available_models and fallback != best_model:
                print(f"âš ï¸  å°è¯•é™çº§åˆ° {fallback}")
                result = self._call_api(fallback, messages)
                if result:
                    return result
        
        print(f"âŒ æ‰€æœ‰AIæ¨¡å‹è°ƒç”¨å¤±è´¥")
        return None
    
    def _select_best_model(self, task_type: str) -> str:
        """æ ¹æ®ä»»åŠ¡ç±»å‹é€‰æ‹©æœ€ä½³æ¨¡å‹"""
        # ä¼˜å…ˆä½¿ç”¨é€‚åˆè¯¥ä»»åŠ¡çš„æ¨¡å‹
        for model_id in self.available_models:
            config = self.SUPPORTED_MODELS[model_id]
            if task_type in config['suitable_for']:
                return model_id
        
        # å¦åˆ™ä½¿ç”¨ä¸»æ¨¡å‹
        if self.primary_model in self.available_models:
            return self.primary_model
        
        # æœ€åä½¿ç”¨ä»»ä½•å¯ç”¨æ¨¡å‹
        return self.available_models[0] if self.available_models else None
    
    def _build_messages(self, task_type: str, content: str,
                       context: Optional[Dict] = None) -> List[Dict]:
        """æ„å»ºæ¶ˆæ¯"""
        messages = []
        
        # ç³»ç»Ÿæç¤º
        if task_type == 'technical':
            system_prompt = """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„é‡åŒ–äº¤æ˜“åˆ†æå¸ˆã€‚
è¯·åˆ†ææä¾›çš„æŠ€æœ¯æŒ‡æ ‡æ•°æ®ï¼Œç»™å‡ºä¹°å–å»ºè®®ã€‚
è¦æ±‚ï¼š
1. åˆ†ææŠ€æœ¯å½¢æ€
2. åˆ¤æ–­è¶‹åŠ¿æ–¹å‘
3. ç»™å‡ºæ“ä½œå»ºè®®
4. è¯„ä¼°é£é™©ç­‰çº§
è¾“å‡ºæ ¼å¼ä¸ºJSONï¼ŒåŒ…å«ï¼šanalysisï¼ˆåˆ†æï¼‰ã€suggestionï¼ˆå»ºè®®ï¼‰ã€riskï¼ˆé£é™©ç­‰çº§1-5ï¼‰"""
        
        elif task_type == 'fundamental':
            system_prompt = """ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„åŸºæœ¬é¢åˆ†æå¸ˆã€‚
è¯·åˆ†ææä¾›çš„å…¬å¸è´¢åŠ¡æ•°æ®å’Œè¡Œä¸šä¿¡æ¯ï¼Œç»™å‡ºæŠ•èµ„å»ºè®®ã€‚
è¦æ±‚ï¼š
1. åˆ†æè´¢åŠ¡å¥åº·åº¦
2. è¯„ä¼°ä¼°å€¼æ°´å¹³
3. å¯¹æ¯”è¡Œä¸šåœ°ä½
4. åˆ—å‡ºæ­£é¢å› ç´ ï¼ˆè‡³å°‘3æ¡ï¼‰
5. åˆ—å‡ºè´Ÿé¢å› ç´ ï¼ˆè‡³å°‘3æ¡ï¼‰
6. ç»™å‡ºç»¼åˆè¯„åˆ†ï¼ˆ0-100ï¼‰
è¾“å‡ºæ ¼å¼ä¸ºJSON"""
        
        elif task_type == 'news':
            system_prompt = """ä½ æ˜¯ä¸€ä½é‡‘èæ–°é—»åˆ†æå¸ˆã€‚
è¯·åˆ†ææä¾›çš„æ–°é—»å†…å®¹ï¼Œè¯„ä¼°å¯¹è‚¡ä»·çš„å½±å“ã€‚
è¦æ±‚ï¼š
1. æƒ…æ„Ÿåˆ†æï¼ˆæ­£é¢/ä¸­æ€§/è´Ÿé¢ï¼‰
2. å½±å“ç¨‹åº¦ï¼ˆ1-5ï¼‰
3. å…³é”®äº‹ä»¶æå–
4. æŠ•èµ„å»ºè®®
è¾“å‡ºæ ¼å¼ä¸ºJSON"""
        
        elif task_type == 'signal_confirm':
            system_prompt = """ä½ æ˜¯ä¸€ä½äº¤æ˜“ä¿¡å·éªŒè¯ä¸“å®¶ã€‚
è¯·éªŒè¯æä¾›çš„äº¤æ˜“ä¿¡å·æ˜¯å¦åˆç†ã€‚
è¦æ±‚ï¼š
1. åˆ†æä¿¡å·åˆç†æ€§
2. ç»“åˆåŸºæœ¬é¢åˆ¤æ–­
3. è¯„ä¼°æˆåŠŸæ¦‚ç‡
4. ç»™å‡ºä»“ä½å»ºè®®
5. å»ºè®®æ­¢æŸä½
è¾“å‡ºæ ¼å¼ä¸ºJSON"""
        
        elif task_type == 'a_stock':
            system_prompt = """ä½ æ˜¯ä¸€ä½Aè‚¡å¸‚åœºä¸“å®¶ã€‚
è¯·åˆ†ææä¾›çš„Aè‚¡æ•°æ®ï¼Œè€ƒè™‘ä¸­å›½å¸‚åœºç‰¹ç‚¹ã€‚
è¦æ±‚ï¼š
1. åˆ†æèµ„é‡‘æµå‘
2. æ”¿ç­–å½±å“è¯„ä¼°
3. å¸‚åœºæƒ…ç»ªåˆ¤æ–­
4. æ“ä½œå»ºè®®
è¾“å‡ºæ ¼å¼ä¸ºJSON"""
        
        else:
            system_prompt = "ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„é‡‘èåˆ†æå¸ˆã€‚"
        
        messages.append({
            'role': 'system',
            'content': system_prompt
        })
        
        # ç”¨æˆ·æ¶ˆæ¯
        user_message = content
        
        # æ·»åŠ ä¸Šä¸‹æ–‡
        if context:
            user_message += f"\n\nä¸Šä¸‹æ–‡ä¿¡æ¯:\n{json.dumps(context, ensure_ascii=False, indent=2)}"
        
        messages.append({
            'role': 'user',
            'content': user_message
        })
        
        return messages


# ä½¿ç”¨ç¤ºä¾‹
if __name__ == '__main__':
    # åˆå§‹åŒ–
    analyzer = AIAnalyzer(primary_model='deepseek')
    
    # æŠ€æœ¯åˆ†æ
    tech_data = """
    è‚¡ç¥¨: è´µå·èŒ…å° (600519)
    å½“å‰ä»·: Â¥1850
    TSF(9): Â¥1865
    LSMA(20): Â¥1840
    å·®å€¼: +Â¥25
    è¶‹åŠ¿: ä¸Šæ¶¨
    """
    
    result = analyzer.analyze('technical', tech_data)
    print("\næŠ€æœ¯åˆ†æ:")
    print(result)
    
    # æ–°é—»åˆ†æ
    news = """
    æ ‡é¢˜: è´µå·èŒ…å°Q4ä¸šç»©è¶…é¢„æœŸï¼Œè¥æ”¶å¢é•¿15%
    å†…å®¹: è´µå·èŒ…å°å‘å¸ƒ2024å¹´Q4è´¢æŠ¥ï¼Œè¥æ”¶åŒæ¯”å¢é•¿15%ï¼Œå‡€åˆ©æ¶¦å¢é•¿18%ï¼Œ
    è¶…å‡ºå¸‚åœºé¢„æœŸã€‚å…¬å¸è¡¨ç¤ºå°†ç»§ç»­æ‰©å¤§äº§èƒ½ï¼ŒåŠ å¼ºæ¸ é“å»ºè®¾ã€‚
    """
    
    result = analyzer.analyze('news', news)
    print("\næ–°é—»åˆ†æ:")
    print(result)
```

---

### **2. AIåˆ†æUIç»„ä»¶ (ui/widgets/ai_panel.py)**

```python
"""
AIåˆ†æé¢æ¿
æ˜¾ç¤ºAIåˆ†æç»“æœ
"""
from PyQt6.QtWidgets import (QWidget, QVBoxLayout, QHBoxLayout,
                             QLabel, QTextEdit, QPushButton, QComboBox,
                             QProgressBar, QFrame)
from PyQt6.QtCore import Qt, pyqtSignal, QThread
from PyQt6.QtGui import QFont
import json


class AIAnalysisThread(QThread):
    """AIåˆ†æçº¿ç¨‹"""
    
    finished = pyqtSignal(str)
    error = pyqtSignal(str)
    
    def __init__(self, analyzer, task_type, content, context=None):
        super().__init__()
        self.analyzer = analyzer
        self.task_type = task_type
        self.content = content
        self.context = context
    
    def run(self):
        """æ‰§è¡Œåˆ†æ"""
        try:
            result = self.analyzer.analyze(
                self.task_type,
                self.content,
                self.context
            )
            
            if result:
                self.finished.emit(result)
            else:
                self.error.emit("AIåˆ†æå¤±è´¥")
        
        except Exception as e:
            self.error.emit(str(e))


class AIPanel(QWidget):
    """AIåˆ†æé¢æ¿"""
    
    def __init__(self, ai_analyzer):
        super().__init__()
        self.ai_analyzer = ai_analyzer
        self.analysis_thread = None
        
        self.init_ui()
    
    def init_ui(self):
        """åˆå§‹åŒ–UI"""
        layout = QVBoxLayout(self)
        
        # æ ‡é¢˜
        title_layout = QHBoxLayout()
        
        title = QLabel("ğŸ¤– AIåˆ†æ")
        title.setFont(QFont("Arial", 14, QFont.Weight.Bold))
        title_layout.addWidget(title)
        
        # AIæ¨¡å‹é€‰æ‹©
        self.model_combo = QComboBox()
        for model_id, config in self.ai_analyzer.SUPPORTED_MODELS.items():
            if model_id in self.ai_analyzer.available_models:
                self.model_combo.addItem(config['name'], model_id)
        title_layout.addWidget(QLabel("æ¨¡å‹:"))
        title_layout.addWidget(self.model_combo)
        
        title_layout.addStretch()
        layout.addLayout(title_layout)
        
        # åˆ†æç±»å‹é€‰æ‹©
        type_layout = QHBoxLayout()
        type_layout.addWidget(QLabel("åˆ†æç±»å‹:"))
        
        self.type_combo = QComboBox()
        self.type_combo.addItem("æŠ€æœ¯åˆ†æ", "technical")
        self.type_combo.addItem("åŸºæœ¬é¢åˆ†æ", "fundamental")
        self.type_combo.addItem("æ–°é—»åˆ†æ", "news")
        self.type_combo.addItem("ä¿¡å·ç¡®è®¤", "signal_confirm")
        self.type_combo.addItem("Aè‚¡åˆ†æ", "a_stock")
        type_layout.addWidget(self.type_combo)
        
        # åˆ†ææŒ‰é’®
        self.analyze_btn = QPushButton("å¼€å§‹åˆ†æ")
        self.analyze_btn.clicked.connect(self.start_analysis)
        type_layout.addWidget(self.analyze_btn)
        
        type_layout.addStretch()
        layout.addLayout(type_layout)
        
        # è¿›åº¦æ¡
        self.progress = QProgressBar()
        self.progress.setMaximum(0)  # ä¸ç¡®å®šè¿›åº¦
        self.progress.hide()
        layout.addWidget(self.progress)
        
        # ç»“æœæ˜¾ç¤º
        result_label = QLabel("åˆ†æç»“æœ:")
        layout.addWidget(result_label)
        
        self.result_text = QTextEdit()
        self.result_text.setReadOnly(True)
        layout.addWidget(self.result_text)
    
    def start_analysis(self):
        """å¼€å§‹åˆ†æ"""
        # è·å–å½“å‰è‚¡ç¥¨æ•°æ®
        # TODO: ä»ä¸»çª—å£è·å–å½“å‰è‚¡ç¥¨çš„æ•°æ®
        
        task_type = self.type_combo.currentData()
        
        # ç¤ºä¾‹æ•°æ®
        if task_type == 'technical':
            content = "TSF: 1865, LSMA: 1840, å·®å€¼: +25"
        elif task_type == 'fundamental':
            content = "PE: 35, PB: 8, ROE: 25%, å‡€åˆ©æ¶¦å¢é•¿: 15%"
        else:
            content = "ç¤ºä¾‹æ•°æ®"
        
        # æ˜¾ç¤ºè¿›åº¦
        self.progress.show()
        self.analyze_btn.setEnabled(False)
        self.result_text.setPlainText("AIåˆ†æä¸­...")
        
        # åˆ›å»ºåˆ†æçº¿ç¨‹
        self.analysis_thread = AIAnalysisThread(
            self.ai_analyzer,
            task_type,
            content
        )
        
        self.analysis_thread.finished.connect(self.on_analysis_finished)
        self.analysis_thread.error.connect(self.on_analysis_error)
        self.analysis_thread.start()
    
    def on_analysis_finished(self, result):
        """åˆ†æå®Œæˆ"""
        self.progress.hide()
        self.analyze_btn.setEnabled(True)
        
        # å°è¯•æ ¼å¼åŒ–JSON
        try:
            data = json.loads(result)
            formatted = json.dumps(data, ensure_ascii=False, indent=2)
            self.result_text.setPlainText(formatted)
        except:
            self.result_text.setPlainText(result)
    
    def on_analysis_error(self, error):
        """åˆ†æé”™è¯¯"""
        self.progress.hide()
        self.analyze_btn.setEnabled(True)
        self.result_text.setPlainText(f"âŒ é”™è¯¯: {error}")
```

---

## âš™ï¸ **é…ç½®æ–‡ä»¶æ›´æ–°**

### **config/settings.pyï¼ˆå®Œæ•´ç‰ˆï¼‰**

```python
"""
ç³»ç»Ÿé…ç½®
æ”¯æŒç¾è‚¡ã€æ¸¯è‚¡ã€Aè‚¡ä¸‰ä¸ªå¸‚åœº
"""
import os
from dotenv import load_dotenv

load_dotenv()

# ==================== æ•°æ®æºé…ç½® ====================

# Futué…ç½®ï¼ˆæ¸¯è‚¡ï¼‰
FUTU_HOST = os.getenv('FUTU_HOST', '127.0.0.1')
FUTU_PORT = int(os.getenv('FUTU_PORT', 11111))

# Financial Datasetsé…ç½®ï¼ˆç¾è‚¡ï¼‰
FINANCIAL_DATASETS_API_KEY = os.getenv('FINANCIAL_DATASETS_API_KEY')

# Tushareé…ç½®ï¼ˆAè‚¡ï¼‰
TUSHARE_TOKEN = os.getenv('TUSHARE_TOKEN')

# ==================== äº¤æ˜“é…ç½® ====================

# Futuäº¤æ˜“å¯†ç 
FUTU_TRADING_PWD = os.getenv('FUTU_TRADING_PWD')

# é»˜è®¤ä½¿ç”¨æ¨¡æ‹Ÿç›˜
DEFAULT_USE_SIMULATE = True

# ä½£é‡‘æ¯”ä¾‹
DEFAULT_COMMISSION = 0.001

# ==================== AIé…ç½® ====================

# DeepSeek
DEEPSEEK_API_KEY = os.getenv('DEEPSEEK_API_KEY')

# ChatGPT
OPENAI_API_KEY = os.getenv('OPENAI_API_KEY')

# Claude
CLAUDE_API_KEY = os.getenv('CLAUDE_API_KEY')

# é€šä¹‰åƒé—®
QWEN_API_KEY = os.getenv('QWEN_API_KEY')

# æ–‡å¿ƒä¸€è¨€
ERNIE_API_KEY = os.getenv('ERNIE_API_KEY')
ERNIE_SECRET_KEY = os.getenv('ERNIE_SECRET_KEY')

# ä¸»åŠ›AIæ¨¡å‹
PRIMARY_AI_MODEL = os.getenv('PRIMARY_AI_MODEL', 'deepseek')

# å¤‡ç”¨AIæ¨¡å‹
FALLBACK_AI_MODELS = ['chatgpt', 'deepseek']

# ==================== ç¼“å­˜é…ç½® ====================

CACHE_DIR = 'data_cache'
CACHE_ENABLED = True

# ==================== å®šæ—¶ä»»åŠ¡é…ç½® ====================

SCHEDULER_ENABLED = True

# ä»»åŠ¡æ—¶é—´é…ç½®
SCHEDULE_HK_SIGNAL = '16:10'    # æ¸¯è‚¡æ”¶ç›˜å
SCHEDULE_A_SIGNAL = '15:05'     # Aè‚¡æ”¶ç›˜å
SCHEDULE_US_SIGNAL = '04:10'    # ç¾è‚¡æ”¶ç›˜å
SCHEDULE_HK_TRADE = '09:25'     # æ¸¯è‚¡å¼€ç›˜å‰
SCHEDULE_A_TRADE = '09:25'      # Aè‚¡å¼€ç›˜å‰
SCHEDULE_US_TRADE = '21:25'     # ç¾è‚¡å¼€ç›˜å‰

# ==================== é€šçŸ¥é…ç½® ====================

NOTIFICATION_ENABLED = True
EMAIL_ENABLED = False
WECHAT_ENABLED = False

# é‚®ä»¶é…ç½®
EMAIL_HOST = os.getenv('EMAIL_HOST', 'smtp.gmail.com')
EMAIL_PORT = int(os.getenv('EMAIL_PORT', 587))
EMAIL_USER = os.getenv('EMAIL_USER')
EMAIL_PASSWORD = os.getenv('EMAIL_PASSWORD')
EMAIL_TO = os.getenv('EMAIL_TO')

# å¾®ä¿¡é€šçŸ¥ï¼ˆServeré…±ï¼‰
SERVERCHAN_KEY = os.getenv('SERVERCHAN_KEY')

# ==================== UIé…ç½® ====================

THEME = 'dark'  # dark/light
WINDOW_SIZE = (1600, 900)

# ==================== æ—¥å¿—é…ç½® ====================

LOG_LEVEL = 'INFO'
LOG_FILE = 'logs/trading_system.log'

# ==================== å¸‚åœºè¯†åˆ« ====================

def get_market_type(stock_code: str) -> str:
    """
    è¯†åˆ«è‚¡ç¥¨æ‰€å±å¸‚åœº
    
    Returns:
    --------
    str : 'US', 'HK', 'A'
    """
    if stock_code.startswith('HK.'):
        return 'HK'
    elif stock_code.isdigit() and len(stock_code) == 6:
        return 'A'
    else:
        return 'US'
```

---

### **.env ç¤ºä¾‹ï¼ˆå®Œæ•´ç‰ˆï¼‰**

```bash
# .env

# ==================== Futué…ç½®ï¼ˆæ¸¯è‚¡ï¼‰====================
FUTU_HOST=127.0.0.1
FUTU_PORT=11111
FUTU_TRADING_PWD=your_password

# ==================== ç¾è‚¡API ====================
FINANCIAL_DATASETS_API_KEY=your_api_key_here

# ==================== Aè‚¡API ====================
# Tushare Tokenï¼ˆæ¨èï¼‰
# è·å–åœ°å€: https://tushare.pro/register
TUSHARE_TOKEN=your_tushare_token_here

# ==================== AIé…ç½® ====================

# DeepSeekï¼ˆæ¨èï¼Œä¾¿å®œï¼‰
# è·å–åœ°å€: https://platform.deepseek.com
DEEPSEEK_API_KEY=sk-your-deepseek-key

# ChatGPT
# è·å–åœ°å€: https://platform.openai.com
OPENAI_API_KEY=sk-your-openai-key

# Claude
# è·å–åœ°å€: https://console.anthropic.com
CLAUDE_API_KEY=sk-ant-your-claude-key

# é€šä¹‰åƒé—®ï¼ˆæ¨èç”¨äºAè‚¡ï¼‰
# è·å–åœ°å€: https://dashscope.aliyun.com
QWEN_API_KEY=sk-your-qwen-key

# æ–‡å¿ƒä¸€è¨€ï¼ˆæ¨èç”¨äºAè‚¡ï¼‰
# è·å–åœ°å€: https://console.bce.baidu.com
ERNIE_API_KEY=your-ernie-api-key
ERNIE_SECRET_KEY=your-ernie-secret-key

# ä¸»åŠ›AIæ¨¡å‹
PRIMARY_AI_MODEL=deepseek

# ==================== é€šçŸ¥é…ç½® ====================

# é‚®ä»¶é€šçŸ¥
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=your_email@gmail.com
EMAIL_PASSWORD=your_password
EMAIL_TO=recipient@example.com

# å¾®ä¿¡é€šçŸ¥ï¼ˆServeré…±ï¼‰
# è·å–åœ°å€: https://sct.ftqq.com
SERVERCHAN_KEY=SCT_your_key
```

---

## ğŸ“¦ **æ›´æ–°çš„ä¾èµ–åˆ—è¡¨**

```txt
# requirements.txt

# UIæ¡†æ¶
PyQt6>=6.4.0
pyqtgraph>=0.13.1

# æ•°æ®å¤„ç†
pandas>=2.0.0
numpy>=1.24.0

# å›¾è¡¨
matplotlib>=3.7.0

# å›æµ‹
backtrader>=1.9.76

# äº¤æ˜“æ¥å£
futu-api>=6.5.0

# APIè¯·æ±‚
requests>=2.31.0

# é…ç½®ç®¡ç†
python-dotenv>=1.0.0

# å®šæ—¶ä»»åŠ¡
schedule>=1.2.0

# æ—¥å¿—
loguru>=0.7.0

# é€šçŸ¥
plyer>=2.1.0  # æ¡Œé¢é€šçŸ¥

# ==================== Aè‚¡æ•°æ® ====================

# Tushareï¼ˆæ¨èï¼‰
tushare>=1.4.0

# ==================== AIç›¸å…³ ====================

# OpenAI SDKï¼ˆDeepSeekå…¼å®¹ï¼‰
openai>=1.12.0

# Anthropic SDKï¼ˆClaudeï¼‰
anthropic>=0.18.0

# é˜¿é‡Œäº‘SDKï¼ˆé€šä¹‰åƒé—®ï¼‰
dashscope>=1.14.0

# æ•°æ®åº“ï¼ˆå¯é€‰ï¼‰
sqlalchemy>=2.0.0

# JSONå¤„ç†
orjson>=3.9.0
```

---

## ğŸ¯ **ä½¿ç”¨ç¤ºä¾‹ï¼ˆAè‚¡+AIï¼‰**

### **1. Aè‚¡æ•°æ®è·å–**

```python
# ä½¿ç”¨Tushare
from data.tushare_data import TushareDataFetcher

fetcher = TushareDataFetcher()

# è·å–è´µå·èŒ…å°æ•°æ®
df = fetcher.get_history_kline('600519', '2024-01-01', '2025-01-22')

# è·å–å®æ—¶ä»·æ ¼ï¼ˆä½¿ç”¨ä¸œæ–¹è´¢å¯Œï¼‰
from data.eastmoney_data import EastMoneyDataFetcher

em_fetcher = EastMoneyDataFetcher()
quote = em_fetcher.get_realtime_price('600519')
print(f"èŒ…å°å½“å‰ä»·: Â¥{quote['price']:.2f}")

# è·å–èµ„é‡‘æµå‘
flow = em_fetcher.get_money_flow('600519')
print(f"ä¸»åŠ›å‡€æµå…¥: Â¥{flow['main_net_inflow']/10000:.2f}ä¸‡")
```

---

### **2. AIåˆ†æä½¿ç”¨**

```python
from core.ai_analyzer import AIAnalyzer

# åˆå§‹åŒ–ï¼ˆè‡ªåŠ¨é€‰æ‹©å¯ç”¨æ¨¡å‹ï¼‰
analyzer = AIAnalyzer(primary_model='deepseek')

# æŠ€æœ¯åˆ†æ
tech_data = """
è‚¡ç¥¨: è´µå·èŒ…å° (600519)
å½“å‰ä»·: Â¥1850
TSF(9): Â¥1865
LSMA(20): Â¥1840
è¶‹åŠ¿: ä¸Šæ¶¨
æˆäº¤é‡: æ”¾å¤§
"""

result = analyzer.analyze('technical', tech_data)
print("æŠ€æœ¯åˆ†æç»“æœ:", result)

# åŸºæœ¬é¢åˆ†æ
fundamental_data = """
è‚¡ç¥¨: è´µå·èŒ…å° (600519)
PE: 35.5
PB: 8.2
ROE: 25.3%
è¥æ”¶å¢é•¿: 15%
å‡€åˆ©æ¶¦å¢é•¿: 18%
è¡Œä¸š: ç™½é…’
"""

result = analyzer.analyze('fundamental', fundamental_data)
print("åŸºæœ¬é¢åˆ†æ:", result)

# Aè‚¡ä¸“é¡¹åˆ†æï¼ˆä½¿ç”¨é€šä¹‰åƒé—®ï¼‰
a_stock_data = """
è‚¡ç¥¨: è´µå·èŒ…å° (600519)
ä¸»åŠ›å‡€æµå…¥: +5000ä¸‡
èµ„é‡‘æµå‘: æŒç»­æµå…¥
æ”¿ç­–: æ¶ˆè´¹å‡çº§
å¸‚åœºæƒ…ç»ª: åå¤š
"""

result = analyzer.analyze('a_stock', a_stock_data)
print("Aè‚¡åˆ†æ:", result)
```

---

### **3. å®Œæ•´å·¥ä½œæµï¼ˆAè‚¡ï¼‰**

```python
# æ¯æ—¥15:05è‡ªåŠ¨è¿è¡Œ

# 1. è·å–æ•°æ®
df = tushare_fetcher.get_history_kline('600519', start, end)
quote = em_fetcher.get_realtime_price('600519')
flow = em_fetcher.get_money_flow('600519')

# 2. è®¡ç®—æŒ‡æ ‡
tsf, lsma = calculate_indicators(df)

# 3. ç”Ÿæˆä¿¡å·
signal = strategy_engine.generate_signal('600519', df)

# 4. AIç¡®è®¤
ai_result = analyzer.analyze('signal_confirm', f"""
ä¿¡å·: {signal['type']}
æŠ€æœ¯é¢: TSF={tsf}, LSMA={lsma}
èµ„é‡‘æµå‘: {flow['main_net_inflow']}
""")

# 5. å‘é€é€šçŸ¥
if signal['type'] != 'HOLD':
    send_notification(signal, ai_result)

# æ¬¡æ—¥09:25è‡ªåŠ¨äº¤æ˜“ï¼ˆå¦‚æœå¯ç”¨ï¼‰
```

---

**å®Œæ•´çš„ä¸‰å¸‚åœº+AIåˆ†æç³»ç»Ÿå·²è®¾è®¡å®Œæˆï¼** ğŸ¯âœ¨

ç°åœ¨æ”¯æŒï¼š
1. âœ… **ç¾è‚¡** - FinancialDatasets API
2. âœ… **æ¸¯è‚¡** - Futu API  
3. âœ… **Aè‚¡** - Tushare + ä¸œæ–¹è´¢å¯Œ
4. âœ… **AIåˆ†æ** - 5ä¸ªæ¨¡å‹å¯é€‰
5. âœ… **è‡ªåŠ¨åŒ–** - å®šæ—¶ä»»åŠ¡
6. âœ… **ç»Ÿä¸€ç•Œé¢** - ä¸€ä¸ªUIç®¡ç†æ‰€æœ‰

å‡†å¤‡å¼€å§‹å®ç°äº†å—ï¼Ÿ ğŸš€
